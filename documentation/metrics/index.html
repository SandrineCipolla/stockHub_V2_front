<!DOCTYPE html>
<html class="dark" lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>üìä StockHub V2 - Dashboard Qualit√© (Dynamique)</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --sh-purple-500: #8b5cf6;
            --sh-purple-400: #a78bfa;
            --sh-purple-300: #c4b5fd;
            --sh-dark-bg: #1a1a3e;
            --sh-card-bg: #0f0f23;
            --sh-border: rgba(255, 255, 255, 0.15);
        }
        body {
            background: var(--sh-dark-bg);
            color: white;
            font-family: 'Inter', sans-serif;
        }
        .card {
            background: var(--sh-card-bg);
            border: 1px solid var(--sh-border);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .section-title {
            font-size: 1.6rem;
            color: var(--sh-purple-400);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        /* Ajout styles tooltips coverage */
        .tooltip-wrapper { position: relative; display:inline-block; }
        .tooltip-box { position:absolute; left:0; top:110%; z-index:20; background:#1f1f2e; color:#fff; padding:.5rem .75rem; font-size:.65rem; line-height:1rem; border:1px solid rgba(255,255,255,.1); width:200px; border-radius:.5rem; box-shadow:0 4px 12px rgba(0,0,0,.4); opacity:0; transform:translateY(-4px); pointer-events:none; transition:.15s ease; }
        .tooltip-wrapper:focus .tooltip-box,
        .tooltip-wrapper:hover .tooltip-box { opacity:1; transform:translateY(0); }

        /* Layout Masonry (style Pinterest) */
        .masonry-grid {
            column-count: 1;
            column-gap: 2.5rem;
            padding: 0;
        }

        @media (min-width: 768px) {
            .masonry-grid {
                column-count: 2;
            }
        }

        @media (min-width: 1280px) {
            .masonry-grid {
                column-count: 2;
            }
        }

        .masonry-grid > * {
            break-inside: avoid;
            page-break-inside: avoid;
            margin-bottom: 2.5rem;
            display: inline-block;
            width: 100%;
        }

        /* Animations et effets visuels */
        .metric-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.3);
        }
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--sh-purple-500), var(--sh-purple-300));
        }
        .pulse-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        .progress-ring {
            transform: rotate(-90deg);
            transition: stroke-dasharray 0.8s ease-in-out;
        }
        .fade-in { animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container { position: relative; height: 200px; }
        .chart-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Retour au centrage original */
            text-align: center;
            z-index: 10;
            pointer-events: none;
            background: rgba(15, 15, 35, 0.9);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .chart-overlay-text {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        /* Nouveaux styles pour les cercles de score Lighthouse */
        .lighthouse-container {
            min-height: 400px;
            padding: 1.5rem;
        }

        .score-circle {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }

        .score-circle-large {
            width: 140px;
            height: 140px;
        }

        .score-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .score-circle-progress {
            transition: stroke-dasharray 1.5s ease-in-out;
            filter: drop-shadow(0 0 8px currentColor);
            stroke-dasharray: 0 282.6; /* Valeur par d√©faut, sera mise √† jour par JS */
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: bold;
        }

        /* Classes utilitaires pour les couleurs de score */
        .text-score-excellent { color: #10b981; }
        .text-score-good { color: #f59e0b; }
        .text-score-poor { color: #ef4444; }

        /* Classes pour les badges de notes */
        .badge-grade-a { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .badge-grade-b { background: linear-gradient(135deg, #10b981, #f59e0b); color: white; }
        .badge-grade-c { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .badge-grade-d { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
        .badge-grade-f { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

        /* Nouveaux styles pour les onglets de daltonisme */
        .daltonisme-tab, .wcag-tab, .rncp-tab, .lighthouse-tab {
            background-color: transparent;
            color: #9ca3af;
            border: none;
            cursor: pointer;
        }

        .daltonisme-tab.active, .wcag-tab.active, .rncp-tab.active, .lighthouse-tab.active {
            background-color: var(--sh-purple-500);
            color: white;
        }

        .daltonisme-tab:hover:not(.active), .wcag-tab:hover:not(.active), .rncp-tab:hover:not(.active), .lighthouse-tab:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
        }

        .daltonisme-panel, .wcag-panel, .rncp-panel, .lighthouse-panel {
            display: none;
        }

        .daltonisme-panel.active, .wcag-panel.active, .rncp-panel.active, .lighthouse-panel.active {
            display: block;
        }

        /* Styles pour les onglets de types de daltonisme */
        .difference-type-content {
            display: none;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .difference-type-content.active {
            display: block;
        }

        /* Styles pour les onglets datasets */
        .dataset-tab-content {
            display: none;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .dataset-tab-content.active {
            display: block;
        }

        /* Styles pour les onglets FPS */
        .fps-tab-content {
            display: none;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .fps-tab-content.active {
            display: block;
        }

        /* Styles pour les onglets Coverage */
        .coverage-tab-content {
            display: none;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .coverage-tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Styles pour les visualisations de couleurs */
        .color-preview {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: inline-block;
            position: relative;
            cursor: help;
        }

        .color-preview.simulated::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: #f59e0b;
            border-radius: 50%;
            border: 1px solid #1f2937;
        }

        /* Styles pour les grilles de comparaison */
        .color-comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            align-items: center;
        }

        .daltonism-type-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.05));
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .daltonism-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
        }

        /* Styles pour les m√©triques Delta E */
        .delta-e-indicator {
            font-family: monospace;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
        }

        .delta-e-good {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .delta-e-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .delta-e-critical {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Animations pour l'√©tat de chargement */
        .loading-shimmer {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Styles responsifs pour les onglets */
        @media (max-width: 768px) {
            .daltonisme-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .color-comparison-grid {
                grid-template-columns: 1fr;
            }

            #daltonisme-content .grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>

<body class="min-h-screen px-6 py-6">

<!-- HEADER -->
<header class="mb-10">
    <h1 class="text-4xl font-bold text-[var(--sh-purple-400)]">
        üìä StockHub V2 ‚Äî Tableau de bord Qualit√©
    </h1>

    <p class="opacity-80 mt-1">
        G√©n√©r√© automatiquement ‚Äî derni√®re mise √† jour :
        <span id="generated-date"></span>
    </p>

    <!-- Lien contextuel selon l'environnement -->
    <a class="mt-4 inline-block text-[var(--sh-purple-300)] underline hover:text-[var(--sh-purple-400)]" href="#"
       id="context-link"
       style="display: none;"
       target="_blank">
    </a>
</header>

<script>
    // Date de g√©n√©ration
    document.getElementById("generated-date").textContent = new Date().toLocaleString("fr-FR");

    // Lien contextuel
    const contextLink = document.getElementById("context-link");
    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const isGitHubPages = window.location.hostname.includes('github.io');

    if (isLocal) {
        // En local : lien vers GitHub Pages
        contextLink.href = "https://sandrinecipolla.github.io/stockHub_V2_front/documentation/metrics/";
        contextLink.textContent = "üåç Voir la version publique GitHub Pages";
        contextLink.style.display = "inline-block";
    } else if (isGitHubPages) {
        // Sur GitHub Pages : lien vers le repo
        contextLink.href = "https://github.com/SandrineCipolla/stockHub_V2_front";
        contextLink.textContent = "üìÇ Voir le code source sur GitHub";
        contextLink.style.display = "inline-block";
    }
    // Sur Vercel ou autre : pas de lien
</script>

<!-- GRID MASONRY -->
<div class="masonry-grid">
    <section class="card metric-card fade-in">
        <h2 class="section-title flex items-center gap-3">
            üî¶ Lighthouse
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="lighthouse-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>

        <!-- Navigation par onglets Lighthouse -->
        <div class="mb-6">
            <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg">
                <button class="lighthouse-tab active px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="overview">
                    üìä Vue d'ensemble
                </button>
                <button class="lighthouse-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="performance">
                    ‚ö° Performance
                </button>
                <button class="lighthouse-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="accessibility">
                    ‚ôø Accessibilit√©
                </button>
                <button class="lighthouse-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="seo">
                    üîç SEO
                </button>
                <button class="lighthouse-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="best-practices">
                    ‚úÖ Best Practices
                </button>
            </div>
        </div>

        <!-- Contenu des onglets Lighthouse -->
        <div id="lighthouse-tabs-content">
            <!-- Vue d'ensemble -->
            <div class="lighthouse-panel active" data-panel="overview">
                <div class="lighthouse-container" id="lighthouse-content">
                    <div class="flex items-center justify-center h-32 text-gray-400">
                        <p>‚è≥ Chargement des scores Lighthouse...</p>
                    </div>
                </div>
            </div>

            <!-- Performance -->
            <div class="lighthouse-panel" data-panel="performance">
                <div id="lighthouse-performance-content">
                    <div class="flex items-center justify-center h-32 text-gray-400">
                        <p>‚è≥ Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- Accessibilit√© -->
            <div class="lighthouse-panel" data-panel="accessibility">
                <div id="lighthouse-accessibility-content">
                    <div class="flex items-center justify-center h-32 text-gray-400">
                        <p>‚è≥ Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- SEO -->
            <div class="lighthouse-panel" data-panel="seo">
                <div id="lighthouse-seo-content">
                    <div class="flex items-center justify-center h-32 text-gray-400">
                        <p>‚è≥ Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- Best Practices -->
            <div class="lighthouse-panel" data-panel="best-practices">
                <div id="lighthouse-best-practices-content">
                    <div class="flex items-center justify-center h-32 text-gray-400">
                        <p>‚è≥ Chargement...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="card metric-card fade-in">
        <h2 class="section-title flex items-center gap-3">
            ‚ö†Ô∏è WCAG Risk Levels
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="wcag-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>
        <p class="text-sm text-gray-400 mb-6">
            Analyse des contrastes de couleurs selon les niveaux de risque (critical, high, medium, low)
        </p>

        <!-- Navigation par onglets WCAG -->
        <div class="mb-6">
            <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg">
                <button class="wcag-tab active px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="overview">
                    üìä Vue d'ensemble
                </button>
                <button class="wcag-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="critical">
                    üî¥ Critique
                </button>
                <button class="wcag-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="high">
                    üü† √âlev√©
                </button>
                <button class="wcag-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="medium">
                    üü° Moyen
                </button>
                <button class="wcag-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="low">
                    üü¢ Faible
                </button>
                <button class="wcag-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="solutions">
                    üîß Solutions
                </button>
            </div>
        </div>

        <!-- Contenu des onglets WCAG -->
        <div id="wcag-content">
            <!-- Vue d'ensemble -->
            <div class="wcag-panel active" data-panel="overview">
                <!-- Contenu √©ducatif -->
                <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-6">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">üí°</div>
                        <div>
                            <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi les WCAG Risk Levels ?</div>
                            <div class="text-xs text-gray-300 space-y-2">
                                <p><strong>WCAG</strong> (Web Content Accessibility Guidelines) d√©finit les <strong>ratios de contraste minimum</strong> pour garantir la lisibilit√© :</p>
                                <ul class="list-disc list-inside ml-2 space-y-1">
                                    <li><strong>4.5:1</strong> minimum pour texte normal (niveau AA)</li>
                                    <li><strong>3:1</strong> minimum pour texte large (‚â•18pt ou ‚â•14pt bold)</li>
                                    <li><strong>7:1</strong> pour niveau AAA (excellence)</li>
                                </ul>
                                <p class="pt-2">Les <strong>risk levels</strong> cat√©gorisent les paires de couleurs selon leur niveau de risque d'accessibilit√© :</p>
                                <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
                                    <div class="flex items-center gap-2 p-2 bg-red-500/10 rounded">
                                        <span>üî¥</span>
                                        <div>
                                            <div class="font-bold text-red-400">Critique</div>
                                            <div class="text-gray-400">Ratio &lt; 3:1</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 bg-orange-500/10 rounded">
                                        <span>üü†</span>
                                        <div>
                                            <div class="font-bold text-orange-400">√âlev√©</div>
                                            <div class="text-gray-400">3:1 - 4.5:1</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 bg-yellow-500/10 rounded">
                                        <span>üü°</span>
                                        <div>
                                            <div class="font-bold text-yellow-400">Moyen</div>
                                            <div class="text-gray-400">4.5:1 - 7:1</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 p-2 bg-green-500/10 rounded">
                                        <span>üü¢</span>
                                        <div>
                                            <div class="font-bold text-green-400">Faible</div>
                                            <div class="text-gray-400">Ratio ‚â• 7:1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistiques d'audit -->
                <div id="wcag-stats" class="grid grid-cols-2 gap-4 mb-6">
                    <!-- Sera rempli dynamiquement -->
                </div>

                <!-- Graphique -->
                <div class="chart-container">
                    <canvas id="chart-wcag"></canvas>
                </div>

                <!-- Recommandations si probl√®mes critiques -->
                <div id="wcag-recommendations" class="mt-6">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Onglet Critique -->
            <div class="wcag-panel" data-panel="critical">
                <div id="critical-problems">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Onglet √âlev√© -->
            <div class="wcag-panel" data-panel="high">
                <div id="high-problems">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Onglet Moyen -->
            <div class="wcag-panel" data-panel="medium">
                <div id="medium-problems">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Onglet Faible -->
            <div class="wcag-panel" data-panel="low">
                <div id="low-problems">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Onglet Solutions -->
            <div class="wcag-panel" data-panel="solutions">
                <div id="wcag-solutions">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>
        </div>
    </section>
    <section class="card metric-card fade-in" id="daltonisme-section">
        <h2 class="section-title flex items-center gap-3">
            üëÅ Tests de Daltonisme & Accessibilit√© Visuelle
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="daltonisme-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>

        <!-- Contenu √©ducatif -->
        <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-6">
            <div class="flex items-start gap-3">
                <div class="text-2xl">üí°</div>
                <div>
                    <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi le Daltonisme ?</div>
                    <div class="text-xs text-gray-300 space-y-2">
                        <p>Le <strong>daltonisme</strong> (ou d√©ficience de la vision des couleurs) affecte environ <strong>8% des hommes et 0.5% des femmes</strong>. Il existe plusieurs types :</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 text-xs">
                            <div class="flex items-start gap-2 p-2 bg-red-500/10 rounded">
                                <span>üî¥</span>
                                <div>
                                    <div class="font-bold text-red-400">Protanopie</div>
                                    <div class="text-gray-400">Difficult√© rouge/vert (1% des hommes)</div>
                                </div>
                            </div>
                            <div class="flex items-start gap-2 p-2 bg-green-500/10 rounded">
                                <span>üü¢</span>
                                <div>
                                    <div class="font-bold text-green-400">Deut√©ranopie</div>
                                    <div class="text-gray-400">Difficult√© rouge/vert (le plus courant, ~5%)</div>
                                </div>
                            </div>
                            <div class="flex items-start gap-2 p-2 bg-blue-500/10 rounded">
                                <span>üîµ</span>
                                <div>
                                    <div class="font-bold text-blue-400">Tritanopie</div>
                                    <div class="text-gray-400">Difficult√© bleu/jaune (tr√®s rare, &lt;0.01%)</div>
                                </div>
                            </div>
                            <div class="flex items-start gap-2 p-2 bg-gray-500/10 rounded">
                                <span>‚ö´</span>
                                <div>
                                    <div class="font-bold text-gray-400">Achromatopsie</div>
                                    <div class="text-gray-400">Vision en niveaux de gris (extr√™mement rare)</div>
                                </div>
                            </div>
                        </div>
                        <p class="pt-2"><strong>Pourquoi c'est important ?</strong> Une interface accessible doit permettre de distinguer les informations critiques sans se baser uniquement sur la couleur (ex: ajouter des ic√¥nes, des textes, des motifs).</p>
                        <p>Ces tests v√©rifient que les <strong>couleurs de statut</strong> (critique, √©lev√©, moyen, faible) restent <strong>diff√©rentiables</strong> pour les utilisateurs daltoniens.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation par onglets -->
        <div class="mb-6">
            <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg">
                <button class="daltonisme-tab active px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="overview">
                    üìä Vue d'ensemble
                </button>
                <button class="daltonisme-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="contrast">
                    üé® Contraste WCAG
                </button>
                <button class="daltonisme-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="simulation">
                    üëÅ Simulation
                </button>
                <button class="daltonisme-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="difference">
                    üîç Diff√©rentiabilit√©
                </button>
            </div>
        </div>

        <!-- Contenu des onglets -->
        <div id="daltonisme-content">
            <!-- Vue d'ensemble -->
            <div class="daltonisme-panel active" data-panel="overview">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Graphique principal -->
                    <div class="chart-container">
                        <canvas id="chart-daltonisme"></canvas>
                    </div>

                    <!-- M√©triques cl√©s -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-lg">
                                <div class="text-2xl font-bold text-blue-400" id="contrast-score">-</div>
                                <div class="text-xs text-gray-400">Tests contraste</div>
                            </div>
                            <div class="p-4 bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-lg">
                                <div class="text-2xl font-bold text-green-400" id="daltonism-score">-</div>
                                <div class="text-xs text-gray-400 tooltip-wrapper" tabindex="0" style="cursor: help; border-bottom: 1px dotted #9ca3af;">
                                    Score moyen ‚ÑπÔ∏è
                                    <div class="tooltip-box">
                                        Moyenne de diff√©rentiabilit√© des 4 types de daltonisme test√©s. Indique le % moyen de paires de couleurs distinguables (ex: Protanopie 90%, Deut√©ranopie 100%, Tritanopie 90%, Achromatopsie 40% = moyenne 80%).
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-gray-800/30 rounded-lg" id="status-colors-preview">
                            <div class="text-sm font-medium text-gray-300 mb-3">Couleurs de statut StockHub</div>
                            <div class="flex flex-wrap gap-2" id="color-status-grid">
                                <!-- Sera rempli dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- R√©sum√© global -->
                <div class="mt-6 p-4 bg-gray-800/30 rounded-lg" id="global-summary">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>

            <!-- Tests de contraste -->
            <div class="daltonisme-panel" data-panel="contrast">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2">
                            <span>&#127912; Tests de Contraste WCAG 2.1</span>
                            <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-300 rounded">AA/AAA</span>
                        </h3>
                        <div class="space-y-3" id="contrast-tests-grid">
                            <!-- Sera rempli dynamiquement -->
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-200 mb-4"><span>üìã Crit√®res WCAG</span></h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg">
                                <div class="font-medium text-green-300">Level AAA (‚â• 7:1)</div>
                                <div class="text-green-200 text-xs">Contraste excellent - Texte normal</div>
                            </div>
                            <div class="p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">
                                <div class="font-medium text-yellow-300">Level AA (‚â• 4.5:1)</div>
                                <div class="text-yellow-200 text-xs">Contraste bon - Standard requis</div>
                            </div>
                            <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                                <div class="font-medium text-blue-300">UI Components (‚â• 3:1)</div>
                                <div class="text-blue-200 text-xs">Contraste minimal - √âl√©ments d'interface</div>
                            </div>
                            <div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg">
                                <div class="font-medium text-red-300">FAIL (&lt; 3:1)</div>
                                <div class="text-red-200 text-xs">Contraste insuffisant - √Ä corriger</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulation des types de daltonisme -->
            <div class="daltonisme-panel" data-panel="simulation">
                <h3 class="text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2">
                    <span>Simulation des Types de Daltonisme</span>
                    <span class="text-xs px-2 py-1 bg-purple-500/20 text-purple-300 rounded">4 types test√©s</span>
                </h3>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6" id="simulation-grid">
                    <!-- Sera rempli dynamiquement avec chaque type de daltonisme -->
                </div>
            </div>

            <!-- Tests de diff√©rentiabilit√© -->
            <div class="daltonisme-panel" data-panel="difference">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">
                    &#128269; Analyse de Diff√©rentiabilit√© des Couleurs
                </h3>

                <!-- Explication du seuil -->
                <div class="mb-4 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-purple-300">
                            <span class="font-semibold">Seuil de diff√©rentiabilit√© : ŒîE ‚â• 40</span>
                        </div>
                        <div class="tooltip-wrapper" tabindex="0" style="cursor: help;">
                            <span class="text-purple-300 text-lg">‚ÑπÔ∏è</span>
                            <div class="tooltip-box" style="width: 300px; right: 0; left: auto;">
                                <div class="font-semibold mb-2">√âchelle Delta E (ŒîE)</div>
                                <div class="space-y-1 text-xs">
                                    <div>‚Ä¢ <strong>ŒîE = 0</strong> : Couleurs identiques</div>
                                    <div>‚Ä¢ <strong>ŒîE = 1-10</strong> : Diff√©rence tr√®s faible</div>
                                    <div>‚Ä¢ <strong>ŒîE = 10-40</strong> : Diff√©rence visible mais faible</div>
                                    <div>‚Ä¢ <strong>ŒîE ‚â• 40</strong> : Diff√©rence clairement visible ‚úÖ</div>
                                </div>
                                <div class="mt-2 pt-2 border-t border-gray-600 text-xs">
                                    Plus le ŒîE est √©lev√©, plus les couleurs sont diff√©rentes.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation par onglets types de daltonisme -->
                <div class="mb-6">
                    <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg" id="difference-tabs-container">
                        <!-- Sera rempli dynamiquement -->
                    </div>
                </div>

                <!-- Contenu des onglets types de daltonisme -->
                <div id="difference-content">
                    <!-- Sera rempli dynamiquement -->
                </div>
            </div>
        </div>
    </section>
    <section class="card metric-card fade-in">
        <h2 class="section-title flex items-center gap-3">
            ‚ö° Performance FPS
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="fps-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>
        <p class="text-sm text-gray-400 mb-4">
            Mesure des performances d'animation et de rendu (objectif : 60 FPS stable)
        </p>
        <div id="fps-result"></div>
    </section>

    <section class="card metric-card fade-in">
        <h2 class="section-title flex items-center gap-3">
            ‚ôø Accessibilit√© ‚Äî Reduced Motion
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="a11y-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>
        <p class="text-sm text-gray-400 mb-4">
            Respect de la pr√©f√©rence "prefers-reduced-motion" pour les utilisateurs sensibles au mouvement
        </p>
        <div id="a11y-result"></div>
    </section>

    <section class="card metric-card fade-in">
        <h2 class="section-title flex items-center gap-3">
            üìä Scalabilit√© ‚Äî Datasets
            <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="datasets-status-badge">
                ‚è≥ Chargement...
            </div>
        </h2>
        <p class="text-sm text-gray-400 mb-4">
            Test de performance avec diff√©rentes tailles de jeux de donn√©es (de 10 √† 10 000 items)
        </p>
        <div id="dataset-result"></div>
    </section>

    <!-- COVERAGE -->
    <section class="card metric-card fade-in" id="coverage-section">
    <h2 class="section-title flex items-center gap-3">
        üìà Coverage des tests
        <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="coverage-status-badge">
            ‚è≥ Chargement...
        </div>
    </h2>
    <p class="text-sm text-gray-400 mb-6">
        Couverture de code par les tests unitaires (Vitest) - Analyse d√©taill√©e par fonctionnalit√©
    </p>
    <div class="space-y-4 text-sm" id="coverage-content">
        <p class="opacity-70">‚è≥ Chargement du r√©sum√© de coverage‚Ä¶</p>
    </div>
</section>

</div>
<!-- Fin du conteneur masonry-grid -->

<!-- AUDIT COMPLET RNCP (toujours √† la fin, pleine largeur) -->
<section class="mt-14 card metric-card fade-in" id="audit-rncp">
    <h2 class="section-title flex items-center gap-3">
        üìö Audit Complet RNCP ‚Äî Synth√®se
        <div class="text-xs px-3 py-1 rounded-full bg-gray-700 text-gray-300" id="audit-rncp-status-badge">
            ‚è≥ Chargement...
        </div>
    </h2>
    <p class="text-sm text-gray-400 mb-6">
        Agr√©gation de tous les audits (Performance, Accessibilit√©, √âco-conception, Qualit√©) pour d√©monstration RNCP 2027
    </p>

    <!-- Navigation par onglets RNCP -->
    <div class="mb-6">
        <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg">
            <button class="rncp-tab active px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="overview">
                üìä Vue d'ensemble
            </button>
            <button class="rncp-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="performance">
                ‚ö° Performance
            </button>
            <button class="rncp-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="accessibility">
                ‚ôø Accessibilit√©
            </button>
            <button class="rncp-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="eco">
                üå± √âco-conception
            </button>
            <button class="rncp-tab px-4 py-2 text-sm font-medium rounded-md transition-all" data-tab="quality">
                üíé Qualit√©
            </button>
        </div>
    </div>

    <!-- Contenu des onglets RNCP -->
    <div id="rncp-content">
        <!-- Vue d'ensemble -->
        <div class="rncp-panel active" data-panel="overview">
            <div id="rncp-overview">
                ‚è≥ Chargement de la vue d'ensemble...
            </div>
        </div>

        <!-- Onglet Performance -->
        <div class="rncp-panel" data-panel="performance">
            <div id="rncp-performance">
                ‚è≥ Chargement des donn√©es de performance...
            </div>
        </div>

        <!-- Onglet Accessibilit√© -->
        <div class="rncp-panel" data-panel="accessibility">
            <div id="rncp-accessibility">
                ‚è≥ Chargement des donn√©es d'accessibilit√©...
            </div>
        </div>

        <!-- Onglet √âco-conception -->
        <div class="rncp-panel" data-panel="eco">
            <div id="rncp-eco">
                ‚è≥ Chargement des donn√©es d'√©co-conception...
            </div>
        </div>

        <!-- Onglet Qualit√© -->
        <div class="rncp-panel" data-panel="quality">
            <div id="rncp-quality">
                ‚è≥ Chargement des donn√©es de qualit√©...
            </div>
        </div>
    </div>
</section>

<!-- FOOTER -->
<footer class="mt-20 pb-10 text-center opacity-70">
    StockHub V2 ¬© 2025 ‚Äî Dashboard Qualit√© g√©n√©r√© automatiquement.
</footer>

<!-- SCRIPT DYNAMIQUE -->
<script>
    const jsonBasePaths = [
        "./data/" // local uniquement (GitHub Pages utilise la liste statique)
    ];

    async function findLatestJSON(prefix) {
        // D√©tecter si on est en local ou sur GitHub Pages
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

        // Liste statique des fichiers disponibles (fallback si le listage de dossier ne fonctionne pas)
        const staticFileList = [
            'lighthouse-1763634146672.json',
            'lighthouse-raw-1763634146672.json',
            'risk-levels-audit-1763634259430.json',
            'daltonisme-1763648733792.json',
            'fps-1763634225042.json',
            'a11y-1763635763804.json',
            'datasets-1763634247354.json',
            'audit-complet-1763634146592.json'
        ];

        // Mapping des pr√©fixes aux patterns de fichiers
        const prefixMapping = {
            'lighthouse': /^lighthouse-\d+\.json$/,
            'lighthouse-raw': /^lighthouse-raw-\d+\.json$/,
            'risk-levels': /^risk-levels-audit-\d+\.json$/,
            'daltonisme': /^daltonisme-\d+\.json$/,
            'fps': /^fps-\d+\.json$/,
            'a11y': /^a11y-\d+\.json$/,
            'datasets': /^datasets-\d+\.json$/,
            'audit-complet': /^audit-complet-\d+\.json$/
        };

        const pattern = prefixMapping[prefix];
        if (!pattern) {
            console.log(`Pattern non trouv√© pour le pr√©fixe: ${prefix}`);
            return null;
        }

        try {
            // Essayer d'abord de lister dynamiquement le dossier data
            const resp = await fetch("./data/");
            if (resp.ok) {
                const text = await resp.text();
                const matches = [...text.matchAll(/href="([^"]+\.json)"/g)]
                    .map(m => m[1])
                    .filter(name => pattern.test(name));
                if (matches.length > 0) {
                    matches.sort().reverse(); // Le plus r√©cent en premier (timestamp descendant)
                    console.log(`Fichier trouv√© pour ${prefix}: ${matches[0]}`);
                    return "./data/" + matches[0];
                }
            }
        } catch (e) {
            console.log(`Erreur lors du listage dynamique pour ${prefix}:`, e);
        }

        // Fallback : utiliser la liste statique
        const staticMatches = staticFileList.filter(name => pattern.test(name));
        if (staticMatches.length > 0) {
            staticMatches.sort().reverse();
            console.log(`Fichier statique trouv√© pour ${prefix}: ${staticMatches[0]}`);
            return "./data/" + staticMatches[0];
        }

        console.log(`Aucun fichier trouv√© pour le pr√©fixe: ${prefix}`);
        return null;
    }

    async function loadJSON(prefix) {
        const url = await findLatestJSON(prefix);
        if (!url) return null;
        const resp = await fetch(url);
        return resp.json();
    }

    // Fonction pour extraire les audits √©chou√©s depuis le fichier raw Lighthouse
    function extractFailedAudits(rawLighthouseData) {
        if (!rawLighthouseData || !rawLighthouseData.audits) {
            return null;
        }

        const categories = {
            performance: [],
            accessibility: [],
            'best-practices': [],
            seo: []
        };

        // Parcourir tous les audits et filtrer ceux qui ont √©chou√©
        Object.entries(rawLighthouseData.audits).forEach(([id, audit]) => {
            if (audit.score !== null && audit.score < 1) {
                const failedAudit = {
                    id: audit.id,
                    title: audit.title,
                    description: audit.description,
                    score: audit.score,
                    displayValue: audit.displayValue
                };

                // Cat√©goriser bas√© sur les patterns d'ID
                if (id.includes('contrast') || id.includes('aria') || id.includes('label') ||
                    id.includes('heading') || id.includes('button') || id.includes('link') ||
                    id.includes('tabindex') || id.includes('lang') || id.includes('meta') ||
                    id.includes('name') || id.includes('role')) {
                    categories.accessibility.push(failedAudit);
                } else if (id.includes('https') || id.includes('console') || id.includes('image') ||
                           id.includes('doctype') || id.includes('charset') || id.includes('vulnerable')) {
                    categories['best-practices'].push(failedAudit);
                } else if (id.includes('meta-description') || id.includes('robots') ||
                           id.includes('canonical') || id.includes('hreflang') || id.includes('title')) {
                    categories.seo.push(failedAudit);
                } else if (id.includes('paint') || id.includes('speed') || id.includes('render') ||
                           id.includes('layout') || id.includes('cls') || id.includes('lcp') ||
                           id.includes('fcp') || id.includes('tti') || id.includes('tbt') ||
                           id.includes('blocking')) {
                    categories.performance.push(failedAudit);
                }
            }
        });

        return categories;
    }

    async function loadAllData() {
        const lighthouse = await loadJSON('lighthouse');
        const wcag = await loadJSON('risk-levels');
        const daltonisme = await loadJSON('daltonisme');
        const fps = await loadJSON('fps');
        const a11y = await loadJSON('a11y');
        const datasets = await loadJSON('datasets');

        // Charger l'audit RNCP complet
        const audit = await loadJSON('audit-complet');

        // Charger le fichier raw Lighthouse et extraire les audits √©chou√©s
        let lighthouseFailedAudits = null;
        try {
            const rawLighthouse = await loadJSON('lighthouse-raw');
            if (rawLighthouse) {
                lighthouseFailedAudits = extractFailedAudits(rawLighthouse);
                console.log('‚úÖ Audits Lighthouse √©chou√©s extraits dynamiquement:', lighthouseFailedAudits);
            }
        } catch (e) {
            console.log('‚ö†Ô∏è Impossible d\'extraire les audits √©chou√©s depuis le fichier raw:', e);
        }

        renderCharts({ lighthouse, wcag, daltonisme, fps, a11y, datasets, lighthouseFailedAudits });

        // Rendre l'audit RNCP dans les nouveaux onglets
        if (audit) {
            renderAudit(audit);
        }
    }

    function renderCharts({ lighthouse, wcag, daltonisme, fps, a11y, datasets, lighthouseFailedAudits }) {
        // Nouvelle visualisation Lighthouse avec des cercles de score individuels
        if (lighthouse?.scores) {
            const scores = lighthouse.scores;
            const avgScore = Math.round((scores.performance + scores.accessibility + scores.seo + scores.bestPractices) / 4);

            // Fonction pour obtenir la couleur selon le score
            const getScoreColor = (score) => {
                if (score >= 90) return '#10b981'; // green
                if (score >= 70) return '#f59e0b'; // amber
                return '#ef4444'; // red
            };

            // Fonction pour obtenir la classe de couleur texte
            const getScoreTextClass = (score) => {
                if (score >= 90) return 'text-score-excellent';
                if (score >= 70) return 'text-score-good';
                return 'text-score-poor';
            };

            // Fonction pour obtenir la note alphab√©tique
            const getGradeLetter = (score) => {
                if (score >= 90) return 'A';
                if (score >= 80) return 'B';
                if (score >= 70) return 'C';
                if (score >= 60) return 'D';
                return 'F';
            };

            // Fonction pour obtenir la classe du badge de note
            const getGradeBadgeClass = (score) => {
                if (score >= 90) return 'badge-grade-a';
                if (score >= 80) return 'badge-grade-b';
                if (score >= 70) return 'badge-grade-c';
                if (score >= 60) return 'badge-grade-d';
                return 'badge-grade-f';
            };

            // Nouvelle visualisation avec cercles anim√©s et scores individuels
            const lighthouseContainer = document.getElementById("lighthouse-content");
            lighthouseContainer.innerHTML = `
                <div class="space-y-6">
                    <!-- Contenu √©ducatif -->
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-6">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">üí°</div>
                            <div>
                                <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi Lighthouse ?</div>
                                <div class="text-xs text-gray-300 space-y-1">
                                    <p><strong>Lighthouse</strong> est un outil open-source d√©velopp√© par <strong>Google</strong> qui audite automatiquement la qualit√© des applications web.</p>
                                    <p class="pt-2">Il mesure <strong>4 cat√©gories principales</strong> :</p>
                                    <ul class="list-disc list-inside ml-2 space-y-1 pt-1">
                                        <li><strong>Performance</strong> : Vitesse de chargement (FCP, LCP, TBT, CLS)</li>
                                        <li><strong>Accessibilit√©</strong> : Conformit√© WCAG, navigation clavier, ARIA</li>
                                        <li><strong>SEO</strong> : Optimisation pour moteurs de recherche (meta, robots.txt)</li>
                                        <li><strong>Best Practices</strong> : S√©curit√© HTTPS, console errors, images optimis√©es</li>
                                    </ul>
                                    <p class="pt-2 text-blue-400">Les scores vont de <strong>0 √† 100</strong> : <strong>‚â•90 = Excellent</strong>, <strong>70-89 = Bon</strong>, <strong>&lt;70 = √Ä am√©liorer</strong>.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Score moyen principal -->
                    <div class="text-center">
                        <div class="score-circle score-circle-large mx-auto">
                            <svg>
                                <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="4" fill="none"/>
                                <circle cx="50%" cy="50%" r="45%" stroke="${getScoreColor(avgScore)}"
                                        stroke-width="4" fill="none" stroke-linecap="round"
                                        class="score-circle-progress" data-score="${avgScore}"/>
                            </svg>
                            <div class="score-text">
                                <div class="text-2xl font-bold ${getScoreTextClass(avgScore)}">${avgScore}</div>
                                <div class="text-xs text-gray-400 mt-1">Score Global</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="${getGradeBadgeClass(avgScore)} grade-badge mx-auto" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                ${getGradeLetter(avgScore)}
                            </div>
                        </div>
                    </div>

                    <!-- Grille des scores individuels -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="score-circle mx-auto">
                                <svg>
                                    <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="3" fill="none"/>
                                    <circle cx="50%" cy="50%" r="45%" stroke="${getScoreColor(scores.performance)}"
                                            stroke-width="3" fill="none" stroke-linecap="round"
                                            class="score-circle-progress" data-score="${scores.performance}"/>
                                </svg>
                                <div class="score-text">
                                    <div class="text-lg font-bold ${getScoreTextClass(scores.performance)}">${scores.performance}</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-sm font-medium text-gray-300">Performance</div>
                                <div class="text-xs text-gray-500">Vitesse de chargement</div>
                            </div>
                        </div>

                        <div class="text-center">
                            <div class="score-circle mx-auto">
                                <svg>
                                    <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="3" fill="none"/>
                                    <circle cx="50%" cy="50%" r="45%" stroke="${getScoreColor(scores.accessibility)}"
                                            stroke-width="3" fill="none" stroke-linecap="round"
                                            class="score-circle-progress" data-score="${scores.accessibility}"/>
                                </svg>
                                <div class="score-text">
                                    <div class="text-lg font-bold ${getScoreTextClass(scores.accessibility)}">${scores.accessibility}</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-sm font-medium text-gray-300">Accessibilit√©</div>
                                <div class="text-xs text-gray-500">Conformit√© a11y</div>
                            </div>
                        </div>

                        <div class="text-center">
                            <div class="score-circle mx-auto">
                                <svg>
                                    <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="3" fill="none"/>
                                    <circle cx="50%" cy="50%" r="45%" stroke="${getScoreColor(scores.seo)}"
                                            stroke-width="3" fill="none" stroke-linecap="round"
                                            class="score-circle-progress" data-score="${scores.seo}"/>
                                </svg>
                                <div class="score-text">
                                    <div class="text-lg font-bold ${getScoreTextClass(scores.seo)}">${scores.seo}</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-sm font-medium text-gray-300">SEO</div>
                                <div class="text-xs text-gray-500">Optimisation moteurs</div>
                            </div>
                        </div>

                        <div class="text-center">
                            <div class="score-circle mx-auto">
                                <svg>
                                    <circle cx="50%" cy="50%" r="45%" stroke="rgba(255,255,255,0.1)" stroke-width="3" fill="none"/>
                                    <circle cx="50%" cy="50%" r="45%" stroke="${getScoreColor(scores.bestPractices)}"
                                            stroke-width="3" fill="none" stroke-linecap="round"
                                            class="score-circle-progress" data-score="${scores.bestPractices}"/>
                                </svg>
                                <div class="score-text">
                                    <div class="text-lg font-bold ${getScoreTextClass(scores.bestPractices)}">${scores.bestPractices}</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="text-sm font-medium text-gray-300">Bonnes Pratiques</div>
                                <div class="text-xs text-gray-500">Standards web</div>
                            </div>
                        </div>
                    </div>

                    <!-- L√©gende des scores -->
                    <div class="flex justify-center space-x-4 text-xs pt-3 border-t border-white/10">
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-gray-400">‚â•90 Excellent</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
                            <span class="text-gray-400">70-89 Bon</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-gray-400">&lt;70 √Ä am√©liorer</span>
                        </div>
                    </div>

                    <!-- M√©triques d√©taill√©es si disponibles -->
                    ${lighthouse.metrics ? `
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="text-xs text-gray-400 mb-2">M√©triques Web Vitals</div>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="flex justify-between p-2 bg-gray-800/50 rounded">
                                    <span class="text-gray-300">FCP</span>
                                    <span class="font-mono text-gray-200">${lighthouse.metrics.fcp || 'N/A'}</span>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-800/50 rounded">
                                    <span class="text-gray-300">LCP</span>
                                    <span class="font-mono text-gray-200">${lighthouse.metrics.lcp || 'N/A'}</span>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-800/50 rounded">
                                    <span class="text-gray-300">TBT</span>
                                    <span class="font-mono text-gray-200">${lighthouse.metrics.tbt || 'N/A'}</span>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-800/50 rounded">
                                    <span class="text-gray-300">CLS</span>
                                    <span class="font-mono text-gray-200">${lighthouse.metrics.cls || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            // Ajouter l'animation apr√®s un court d√©lai pour l'effet visuel
            setTimeout(() => {
                const progressRings = lighthouseContainer.querySelectorAll('.score-circle-progress');
                progressRings.forEach(ring => {
                    const score = parseInt(ring.getAttribute('data-score'));

                    // D√©tecter la taille du cercle pour ajuster la circonf√©rence
                    const isLargeCircle = ring.closest('.score-circle-large') !== null;

                    // Circonf√©rence ajust√©e selon la taille du cercle
                    // Cercle large (140px) vs cercle normal (100px) = ratio 1.4
                    const circumference = isLargeCircle ? 396 : 283; // 283 * 1.4 ‚âà 396

                    // Calculer le dash array pour le pourcentage de score
                    const strokeDashArray = (score / 100) * circumference;

                    ring.style.strokeDasharray = `${strokeDashArray} ${circumference}`;
                });
            }, 200);

            // Mettre √† jour le badge de statut Lighthouse
            const lighthouseStatusBadge = document.getElementById('lighthouse-status-badge');
            if (lighthouseStatusBadge) {
                const hasExcellent = avgScore >= 90;
                const hasGood = avgScore >= 70;
                lighthouseStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                    hasExcellent ? 'bg-green-500/20 text-green-400' :
                    hasGood ? 'bg-yellow-500/20 text-yellow-400' :
                    'bg-red-500/20 text-red-400'
                }`;
                lighthouseStatusBadge.textContent = hasExcellent ? '‚úÖ Excellent' : hasGood ? '‚ö†Ô∏è Bon' : '‚ùå √Ä am√©liorer';
            }

            // Remplir les autres onglets Lighthouse
            renderLighthouseDetails(lighthouse, scores, lighthouseFailedAudits);

            // Initialiser la navigation par onglets
            initLighthouseTabs();

        } else {
            document.getElementById("lighthouse-content").innerHTML =
                '<div class="flex items-center justify-center h-32 text-gray-400"><p>‚è≥ Analyse Lighthouse en cours...</p></div>';
        }

        // WCAG - Nouvelle version avec onglets et informations d√©taill√©es
        if (wcag) {
            try {
                // Extraire les donn√©es selon la vraie structure du JSON risk-levels-audit
                let critiques = 0, eleves = 0, moyens = 0, faibles = 0;
                const detailedProblems = {
                    critical: [],
                    high: [],
                    medium: [],
                    low: []
                };

                if (wcag.contraste) {
                    Object.entries(wcag.contraste).forEach(([themeName, theme]) => {
                        if (theme.tests) {
                            theme.tests.forEach(test => {
                                // Ne traiter que les tests qui √©chouent
                                if (!test.passesNormal && test.ratio != null && test.hex) {
                                // D√©terminer la criticit√© selon l'√©cart au seuil WCAG AA (4.5:1)
                                const requiredRatio = 4.5;
                                const gap = requiredRatio - test.ratio;
                                let problemLevel = 'medium';

                                if (gap >= 2.0) problemLevel = 'critical'; // Tr√®s loin du seuil
                                else if (gap >= 1.0) problemLevel = 'high'; // Assez loin
                                else if (gap >= 0.5) problemLevel = 'medium'; // Proche
                                else problemLevel = 'low'; // Tr√®s proche

                                const problem = {
                                    riskLevel: test.level || 'unknown', // critical, high, medium, low (risk level du stock)
                                    color: test.hex,
                                    ratio: test.ratio.toFixed(2),
                                    expected: requiredRatio.toFixed(1),
                                    theme: themeName,
                                    passesLarge: test.passesLarge || false,
                                    wcagLevel: test.wcagLevel || 'FAIL',
                                    gap: gap.toFixed(2),
                                    location: 'Design System: sh-stock-prediction-card',
                                    file: 'stockhub_design_system/src/components/organisms/sh-stock-prediction-card',
                                    problemLevel: problemLevel
                                };

                                switch(problemLevel) {
                                    case 'critical':
                                        critiques++;
                                        detailedProblems.critical.push(problem);
                                        break;
                                    case 'high':
                                        eleves++;
                                        detailedProblems.high.push(problem);
                                        break;
                                    case 'medium':
                                        moyens++;
                                        detailedProblems.medium.push(problem);
                                        break;
                                    case 'low':
                                        faibles++;
                                        detailedProblems.low.push(problem);
                                        break;
                                }
                            }
                        });
                    }
                });
            }

            const total = critiques + eleves + moyens + faibles;

            // D√©truire l'ancien graphique WCAG s'il existe
            const existingWcagChart = Chart.getChart("chart-wcag");
            if (existingWcagChart) {
                existingWcagChart.destroy();
            }

            // Cr√©er le graphique WCAG
            new Chart(document.getElementById("chart-wcag"), {
                type: "bar",
                data: {
                    labels: ["üî¥ Critique", "üü† √âlev√©", "üü° Moyen", "üü¢ Faible"],
                    datasets: [{
                        data: [critiques, eleves, moyens, faibles],
                        backgroundColor: ["#ef4444", "#f97316", "#facc15", "#4ade80"],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const percentage = total > 0 ? ((context.parsed.y / total) * 100).toFixed(1) : 0;
                                    return `${context.parsed.y} probl√®mes (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#9ca3af' }
                        },
                        x: {
                            ticks: { color: '#9ca3af' }
                        }
                    }
                }
            });

            // Remplir les statistiques d'audit
            const wcagStatsContainer = document.getElementById('wcag-stats');
            const totalTests = total;
            const passRate = total > 0 ? (((critiques + eleves + moyens + faibles) / total) * 100).toFixed(1) : 0;

            wcagStatsContainer.innerHTML = `
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm text-gray-400 mb-1">üìä Tests effectu√©s</div>
                    <div class="text-2xl font-bold text-purple-400">${totalTests}</div>
                    <div class="text-xs text-gray-500 mt-1">Paires de couleurs analys√©es</div>
                </div>
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm text-gray-400 mb-1">‚ö†Ô∏è Probl√®mes d√©tect√©s</div>
                    <div class="text-2xl font-bold ${critiques > 0 ? 'text-red-400' : 'text-green-400'}">${total}</div>
                    <div class="text-xs text-gray-500 mt-1">${critiques > 0 ? `Dont ${critiques} critiques` : 'Aucun probl√®me critique'}</div>
                </div>
            `;

            // Ajouter les recommandations si probl√®mes critiques ou √©lev√©s
            const wcagRecommendationsContainer = document.getElementById('wcag-recommendations');
            if (critiques > 0 || eleves > 0) {
                const recommendations = [];

                if (critiques > 0) {
                    recommendations.push({
                        icon: 'üî¥',
                        title: `${critiques} probl√®me${critiques > 1 ? 's' : ''} critique${critiques > 1 ? 's' : ''} √† corriger d'urgence`,
                        desc: 'Ratio de contraste < 3:1. Ces couleurs sont illisibles pour beaucoup d\'utilisateurs.',
                        action: 'Augmenter le contraste ou changer les couleurs'
                    });
                }

                if (eleves > 0) {
                    recommendations.push({
                        icon: 'üü†',
                        title: `${eleves} probl√®me${eleves > 1 ? 's' : ''} de niveau √©lev√©`,
                        desc: 'Ratio entre 3:1 et 4.5:1. Non conforme WCAG AA pour texte normal.',
                        action: 'Am√©liorer le contraste pour atteindre 4.5:1 minimum'
                    });
                }

                if (moyens > 0) {
                    recommendations.push({
                        icon: 'üü°',
                        title: `${moyens} probl√®me${moyens > 1 ? 's' : ''} de niveau moyen`,
                        desc: 'Ratio entre 4.5:1 et 7:1. Conforme AA mais pas AAA.',
                        action: 'Optionnel : viser 7:1 pour excellence (AAA)'
                    });
                }

                wcagRecommendationsContainer.innerHTML = `
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-semibold text-yellow-300 mb-3">‚ö†Ô∏è Recommandations d'am√©lioration</div>
                        <div class="space-y-3">
                            ${recommendations.map(rec => `
                                <div class="flex items-start gap-3">
                                    <div class="text-xl">${rec.icon}</div>
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-yellow-200">${rec.title}</div>
                                        <div class="text-xs text-gray-300 mt-1">${rec.desc}</div>
                                        <div class="text-xs text-purple-400 mt-1 font-semibold">‚Üí ${rec.action}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-4 p-3 bg-gray-800/50 rounded text-xs">
                            <div class="font-semibold text-gray-300 mb-2">üîß Outils recommand√©s :</div>
                            <ul class="list-disc list-inside space-y-1 text-gray-400">
                                <li><strong>WebAIM Contrast Checker</strong> : Tester vos ratios de contraste</li>
                                <li><strong>Chrome DevTools</strong> : Suggestion de couleurs accessibles</li>
                                <li><strong>Figma A11y plugins</strong> : V√©rifier le design en amont</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (total > 0) {
                wcagRecommendationsContainer.innerHTML = `
                    <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl">‚úÖ</div>
                            <div>
                                <div class="text-sm font-semibold text-green-300">Excellent ! Tous les contrastes sont conformes WCAG</div>
                                <div class="text-xs text-gray-300 mt-1">
                                    ${faibles > 0 ? `${faibles} paire${faibles > 1 ? 's' : ''} atteint${faibles > 1 ? '' : ''} m√™me le niveau AAA (‚â•7:1)` : 'Tous les tests sont valid√©s'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Fonction pour initialiser les onglets WCAG
            function initWcagTabs() {
                const tabs = document.querySelectorAll('.wcag-tab');
                const panels = document.querySelectorAll('.wcag-panel');
                const wcagContent = document.getElementById('wcag-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetPanel = tab.dataset.tab;

                        // D√©sactiver tous les onglets et panneaux
                        tabs.forEach(t => t.classList.remove('active'));
                        panels.forEach(p => p.classList.remove('active'));

                        // Activer l'onglet et le panneau s√©lectionn√©s (chercher uniquement dans wcag-content)
                        tab.classList.add('active');
                        const panel = wcagContent.querySelector(`.wcag-panel[data-panel="${targetPanel}"]`);
                        if (panel) {
                            panel.classList.add('active');

                            // Si on revient sur l'onglet overview, forcer le redraw du chart
                            if (targetPanel === 'overview') {
                                // Attendre que le panel soit visible avant de redessiner
                                requestAnimationFrame(() => {
                                    const chart = Chart.getChart("chart-wcag");
                                    if (chart) {
                                        chart.resize();
                                        chart.update('none'); // 'none' pour √©viter l'animation
                                    }
                                });
                            }
                        }
                    });
                });
            }

            // Fonction pour remplir les onglets de probl√®mes
            function populateWcagProblems() {
                const levels = ['critical', 'high', 'medium', 'low'];
                const levelColors = {
                    critical: 'border-red-500 bg-red-500/10',
                    high: 'border-orange-500 bg-orange-500/10',
                    medium: 'border-yellow-500 bg-yellow-500/10',
                    low: 'border-green-500 bg-green-500/10'
                };

                levels.forEach(level => {
                    const container = document.getElementById(`${level}-problems`);
                    const problems = detailedProblems[level];

                    if (!container) return;

                    if (!problems || problems.length === 0) {
                        container.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-32 text-gray-400">
                                <div class="text-4xl mb-2">‚úÖ</div>
                                <p>Aucun probl√®me de niveau ${level}</p>
                            </div>
                        `;
                        return;
                    }

                    container.innerHTML = `
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-200 mb-4">
                                ${problems.length} probl√®me${problems.length > 1 ? 's' : ''} de niveau ${level}
                            </h3>
                            ${problems.map((problem, index) => `
                                <div class="p-4 ${levelColors[level]} border rounded-lg">
                                    <div class="flex justify-between items-start mb-3">
                                        <div class="font-medium text-gray-200 flex items-center gap-2">
                                            <div class="w-6 h-6 rounded border-2 border-white/30" style="background-color: ${problem.color}" title="${problem.color}"></div>
                                            Risk Level "${problem.riskLevel}" - Th√®me ${problem.theme}
                                        </div>
                                        <span class="text-xs px-2 py-1 bg-gray-600 text-gray-200 rounded">
                                            ${level.toUpperCase()}
                                        </span>
                                    </div>

                                    <div class="space-y-2 text-sm text-gray-300">
                                        <div class="grid grid-cols-2 gap-3">
                                            <div><strong>Couleur:</strong> <code class="bg-gray-700 px-2 py-0.5 rounded">${problem.color}</code></div>
                                            <div><strong>Th√®me:</strong> ${problem.theme}</div>
                                            <div><strong>Ratio actuel:</strong> <span class="text-red-400">${problem.ratio}:1</span></div>
                                            <div><strong>Ratio requis:</strong> <span class="text-green-400">${problem.expected}:1</span></div>
                                            <div><strong>√âcart:</strong> <span class="text-orange-400">${problem.gap}</span></div>
                                            <div><strong>Texte large:</strong> ${problem.passesLarge ? '‚úÖ Passe' : '‚ùå √âchoue'}</div>
                                        </div>

                                        <div class="mt-3 p-3 bg-purple-500/10 border border-purple-500/20 rounded">
                                            <strong class="text-purple-300">üìç Emplacement:</strong>
                                            <div class="text-xs mt-2 space-y-1">
                                                <div>‚Ä¢ <strong>Composant:</strong> ${problem.location}</div>
                                                <div>‚Ä¢ <strong>Chemin:</strong> <code class="bg-gray-700 px-1 rounded">${problem.file}</code></div>
                                                <div>‚Ä¢ <strong>Variable √† chercher:</strong> <code class="bg-gray-700 px-1 rounded">${problem.riskLevel}</code> dans le mode <code class="bg-gray-700 px-1 rounded">${problem.theme}</code></div>
                                            </div>
                                        </div>

                                        <div class="mt-3 p-3 bg-blue-500/10 border border-blue-500/20 rounded">
                                            <strong class="text-blue-300">üí° Comment corriger:</strong>
                                            <div class="text-xs mt-2 space-y-1">
                                                <div>1. Ouvrir le repo Design System: <code class="bg-gray-700 px-1 rounded">C:\\Users\\sandr\\Dev\\RNCP7\\stockhub_design_system</code></div>
                                                <div>2. Chercher le fichier <code class="bg-gray-700 px-1 rounded">sh-stock-prediction-card</code></div>
                                                <div>3. Trouver la couleur <code class="bg-gray-700 px-1 rounded">${problem.color}</code> pour risk level "${problem.riskLevel}" en mode ${problem.theme}</div>
                                                <div>4. Remplacer par une couleur plus fonc√©e (ex: <code class="bg-gray-700 px-1 rounded">#b45309</code> ratio 5.02:1)</div>
                                                <div>5. Tester avec WebAIM: <a href="https://webaim.org/resources/contrastchecker/?fcolor=${problem.color.replace('#','')}&bcolor=${problem.theme === 'dark' ? '1e293b' : 'ffffff'}" class="text-blue-400 underline" target="_blank">Ouvrir WebAIM</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                });
            }

            // Remplir l'onglet solutions
            document.getElementById('wcag-solutions').innerHTML = `
                <div class="space-y-6">
                    <h3 class="text-lg font-semibold text-gray-200"><span>üõ†Ô∏è Outils et ressources</span></h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                            <h4 class="font-medium text-blue-300 mb-2">WebAIM Contrast Checker</h4>
                            <p class="text-xs text-gray-300 mb-2">Outil gratuit pour tester le contraste</p>
                            <a href="https://webaim.org/resources/contrastchecker/" class="text-blue-400 underline text-xs" target="_blank">
                                ‚Üí Ouvrir WebAIM
                            </a>
                        </div>
                        <div class="p-4 bg-green-500/10 border border-green-500/20 rounded-lg">
                            <h4 class="font-medium text-green-300 mb-2">DevTools navigateur</h4>
                            <p class="text-xs text-gray-300">F12 > Onglet Accessibility</p>
                        </div>
                    </div>

                    <div class="border-t border-gray-600 pt-4">
                        <h4 class="font-medium text-gray-200 mb-3">Standards WCAG 2.1</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                            <div class="p-3 bg-green-500/10 border border-green-500/20 rounded">
                                <div class="font-medium text-green-300">AAA (‚â• 7:1)</div>
                                <div class="text-gray-300">Excellent</div>
                            </div>
                            <div class="p-3 bg-yellow-500/10 border border-yellow-500/20 rounded">
                                <div class="font-medium text-yellow-300">AA (‚â• 4.5:1)</div>
                                <div class="text-gray-300">Standard requis</div>
                            </div>
                            <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded">
                                <div class="font-medium text-blue-300">UI (‚â• 3:1)</div>
                                <div class="text-gray-300">Interface</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Mettre √† jour le badge de statut
            const wcagStatusBadge = document.getElementById('wcag-status-badge');
            if (wcagStatusBadge) {
                const hasCritical = critiques > 0;
                wcagStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                    hasCritical ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'
                }`;
                wcagStatusBadge.textContent = hasCritical ? `${critiques} Critique${critiques > 1 ? 's' : ''}` : '‚úÖ Conforme';
            }

            // Initialiser les onglets et remplir le contenu
            setTimeout(() => {
                initWcagTabs();
                populateWcagProblems();
            }, 100);

            } catch (error) {
                console.error('Erreur lors du traitement des donn√©es WCAG:', error);
                document.getElementById("chart-wcag").innerHTML =
                    '<div class="flex items-center justify-center h-32 text-red-400"><p>‚ùå Erreur lors du chargement des donn√©es WCAG</p></div>';
            }
        } else {
            document.getElementById("chart-wcag").innerHTML =
                '<div class="flex items-center justify-center h-32 text-gray-400"><p>‚è≥ Analyse WCAG en cours...</p></div>';
        }

        // Daltonisme - Affichage am√©lior√© avec tous les tests d√©taill√©s
        if (daltonisme) {
            // Analyser les donn√©es de contraste daltonisme
            const stats = { passed: 0, failed: 0, aaa: 0, aa: 0, fail: 0 };
            const allTests = [];

            if (daltonisme.contraste && daltonisme.contraste.tests) {
                daltonisme.contraste.tests.forEach(test => {
                    if (test.passes) stats.passed++;
                    else stats.failed++;

                    switch(test.level) {
                        case 'AAA': stats.aaa++; break;
                        case 'AA': stats.aa++; break;
                        case 'FAIL': stats.fail++; break;
                    }

                    // Ajouter le test √† la liste compl√®te
                    allTests.push({
                        ...test,
                        type: 'contraste'
                    });
                });
            }

            // Analyser les autres types de tests s'ils existent
            Object.entries(daltonisme).forEach(([testType, testData]) => {
                if (testType !== 'contraste' && testData && testData.tests) {
                    testData.tests.forEach(test => {
                        allTests.push({
                            ...test,
                            type: testType
                        });
                    });
                }
            });

            // Fonctions pour la gestion des onglets daltonisme
            function initDaltonismeTabs() {
                const tabs = document.querySelectorAll('.daltonisme-tab');
                const panels = document.querySelectorAll('.daltonisme-panel');
                const daltonismeContent = document.getElementById('daltonisme-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetPanel = tab.dataset.tab;

                        // D√©sactiver tous les onglets et panneaux
                        tabs.forEach(t => t.classList.remove('active'));
                        panels.forEach(p => p.classList.remove('active'));

                        // Activer l'onglet et le panneau s√©lectionn√©s (chercher uniquement dans daltonisme-content)
                        tab.classList.add('active');
                        const panel = daltonismeContent.querySelector(`.daltonisme-panel[data-panel="${targetPanel}"]`);
                        if (panel) {
                            panel.classList.add('active');

                            // Si on revient sur l'onglet overview, forcer le redraw du chart
                            if (targetPanel === 'overview') {
                                // Attendre que le panel soit visible avant de redessiner
                                requestAnimationFrame(() => {
                                    const chart = Chart.getChart("chart-daltonisme");
                                    if (chart) {
                                        chart.resize();
                                        chart.update('none'); // 'none' pour √©viter l'animation
                                    }
                                });
                            }
                        }
                    });
                });
            }

            // Fonction pour remplir les couleurs de statut
            function populateStatusColors() {
                const STATUS_COLORS = {
                    optimal: { name: 'Optimal', light: '#10b981', dark: '#34d399', label: '‚úì' },
                    low: { name: 'Stock Faible', light: '#f59e0b', dark: '#fbbf24', label: '‚ö†' },
                    critical: { name: 'Critique', light: '#ef4444', dark: '#f87171', label: '!' },
                    outOfStock: { name: 'Rupture', light: '#6b7280', dark: '#9ca3af', label: '‚úï' },
                    overstocked: { name: 'Surstock', light: '#3b82f6', dark: '#60a5fa', label: '‚Üë' }
                };

                const colorGrid = document.getElementById('color-status-grid');
                if (colorGrid) {
                    colorGrid.innerHTML = Object.entries(STATUS_COLORS).map(([key, status]) => `
                        <div class="flex items-center gap-2 p-2 bg-gray-700/30 rounded">
                            <div class="color-preview" style="background-color: ${status.light}" title="${status.name} (light mode)"></div>
                            <div class="color-preview" style="background-color: ${status.dark}" title="${status.name} (dark mode)"></div>
                            <span class="text-xs text-gray-300">${status.label} ${status.name}</span>
                        </div>
                    `).join('');
                }
            }

            // Fonction pour remplir les tests de contraste
            function populateContrastTests() {
                const contrastGrid = document.getElementById('contrast-tests-grid');
                if (contrastGrid && daltonisme.contraste && daltonisme.contraste.tests) {
                    contrastGrid.innerHTML = daltonisme.contraste.tests.map(test => {
                        // Calculer la conformit√© r√©elle bas√©e sur le ratio de contraste
                        const ratio = test.ratio || test.contrastRatio || 0;
                        const expectedRatio = test.expectedRatio || (test.level === 'AAA' ? 7.0 : test.level === 'AA' ? 4.5 : 3.0);

                        // D√©terminer la conformit√© r√©elle
                        const actuallyPasses = ratio >= expectedRatio;

                        // Recalculer le level bas√© sur le ratio r√©el
                        let actualLevel = 'FAIL';
                        if (ratio >= 7.0) {
                            actualLevel = 'AAA';
                        } else if (ratio >= 4.5) {
                            actualLevel = 'AA';
                        } else if (ratio >= 3.0) {
                            actualLevel = 'UI';
                        }

                        const levelColor = actualLevel === 'AAA' ? 'border-green-500 bg-green-900/20' :
                                         actualLevel === 'AA' ? 'border-yellow-500 bg-yellow-900/20' :
                                         actualLevel === 'UI' ? 'border-blue-500 bg-blue-900/20' :
                                         'border-red-500 bg-red-900/20';

                        const statusIcon = actuallyPasses ? '‚úÖ' : '‚ùå';
                        const statusText = actuallyPasses ? 'Conforme' : 'Non conforme';
                        const statusColor = actuallyPasses ? 'text-green-400' : 'text-red-400';

                        // Extraire le contexte du test pour plus de clart√©
                        const testContext = test.context || test.description || test.selector || '√âl√©ment non sp√©cifi√©';
                        const testType = test.type || 'Contraste de couleur';
                        const backgroundMode = test.background || 'mode non sp√©cifi√©';
                        const statusType = test.status || 'statut non sp√©cifi√©';

                        // D√©terminer l'ic√¥ne et la couleur du mode
                        let modeDisplay = '';
                        if (backgroundMode === 'dark') {
                            modeDisplay = `<span class="inline-flex items-center gap-1 px-2 py-1 text-xs bg-gray-800 text-gray-200 rounded-md border border-gray-600">
                                üåô Mode sombre
                            </span>`;
                        } else if (backgroundMode === 'light') {
                            modeDisplay = `<span class="inline-flex items-center gap-1 px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded-md border border-gray-300">
                                ‚òÄÔ∏è Mode clair
                            </span>`;
                        } else {
                            modeDisplay = `<span class="inline-flex items-center gap-1 px-2 py-1 text-xs bg-purple-500/20 text-purple-300 rounded-md border border-purple-500/30">
                                ‚ùì ${backgroundMode}
                            </span>`;
                        }

                        // Affichage du type de statut test√©
                        const statusColors = {
                            optimal: 'bg-green-500/20 text-green-400 border-green-500/30',
                            low: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
                            critical: 'bg-red-500/20 text-red-400 border-red-500/30',
                            outOfStock: 'bg-gray-500/20 text-gray-400 border-gray-500/30',
                            overstocked: 'bg-blue-500/20 text-blue-400 border-blue-500/30'
                        };
                        const statusColorClass = statusColors[statusType] || 'bg-purple-500/20 text-purple-300 border-purple-500/30';

                        let statusDisplay = `<span class="inline-flex items-center gap-1 px-2 py-1 text-xs rounded-md border ${statusColorClass}">
                            üìä ${statusType}
                        </span>`;

                        // Informations sur les couleurs test√©es
                        let colorInfo = '';
                        if (test.foregroundColor && test.backgroundColor) {
                            colorInfo = `Texte: ${test.foregroundColor} sur ${test.backgroundColor}`;
                        } else if (test.colors) {
                            const colors = Object.entries(test.colors).map(([key, value]) => `${key}: ${value}`).join(' / ');
                            colorInfo = colors;
                        } else if (test.element) {
                            colorInfo = `√âl√©ment: ${test.element}`;
                        }

                        return `
                            <div class="p-4 ${levelColor} border rounded-lg">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg">${statusIcon}</span>
                                        <div class="flex-1">
                                            <div class="font-medium ${statusColor}">${statusText}</div>
                                            <div class="mt-2 flex flex-wrap gap-2">
                                                ${modeDisplay}
                                                ${statusDisplay}
                                            </div>
                                            ${colorInfo ? `<div class="text-xs text-blue-300 mt-2">${colorInfo}</div>` : ''}
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${
                                        actualLevel === 'AAA' ? 'bg-green-500/20 text-green-400' :
                                        actualLevel === 'AA' ? 'bg-yellow-500/20 text-yellow-400' :
                                        actualLevel === 'UI' ? 'bg-blue-500/20 text-blue-400' :
                                        'bg-red-500/20 text-red-400'
                                    }">
                                        ${actualLevel}
                                    </span>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Ratio de contraste:</span>
                                        <span class="font-mono ${statusColor}">${test.ratio?.toFixed(2) || 'N/A'}:1</span>
                                    </div>
                                    ${test.expectedRatio ? `
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-400">Requis:</span>
                                            <span class="font-mono text-gray-300">${test.expectedRatio}:1</span>
                                        </div>
                                    ` : ''}
                                    <div class="text-xs ${statusColor} bg-gray-800/50 p-2 rounded">
                                        ${test.passes ?
                                            '‚úÖ Respecte les standards WCAG - Lisible pour tous les utilisateurs' :
                                            '‚ùå Contraste insuffisant - Difficile √† lire pour les utilisateurs malvoyants'
                                        }
                                    </div>
                                    ${testContext && testContext !== '√âl√©ment non sp√©cifi√©' ? `
                                        <div class="text-xs text-gray-500 border-t border-gray-700 pt-2 mt-2">
                                            <span class="font-medium">Contexte:</span> ${testContext}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            // Fonction pour remplir les simulations de daltonisme
            function populateSimulations() {
                const simulationGrid = document.getElementById('simulation-grid');
                if (simulationGrid && daltonisme.daltonisme) {
                    const daltonismTypes = {
                        protanopia: { name: 'Protanopie', desc: 'D√©ficit rouge-vert (~1% hommes)', color: '#ef4444' },
                        deuteranopia: { name: 'Deut√©ranopie', desc: 'D√©ficit rouge-vert (~1% hommes)', color: '#f59e0b' },
                        tritanopia: { name: 'Tritanopie', desc: 'D√©ficit bleu-jaune (~0.01%)', color: '#3b82f6' },
                        achromatopsie: { name: 'Achromatopsie', desc: 'Monochrome (tr√®s rare)', color: '#6b7280' }
                    };

                    simulationGrid.innerHTML = Object.entries(daltonisme.daltonisme).map(([type, data]) => {
                        const typeInfo = daltonismTypes[type] || { name: type, desc: 'Type de daltonisme', color: '#8b5cf6' };
                        const passedDifferences = data.differences?.filter(d => d.differentiable).length || 0;
                        const totalDifferences = data.differences?.length || 0;
                        const percentage = totalDifferences > 0 ? ((passedDifferences / totalDifferences) * 100).toFixed(0) : 0;

                        return `
                            <div class="daltonism-type-card">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-4 h-4 rounded-full" style="background-color: ${typeInfo.color}"></div>
                                    <div>
                                        <h4 class="font-semibold text-gray-200">${typeInfo.name}</h4>
                                        <p class="text-xs text-gray-400">${typeInfo.desc}</p>
                                    </div>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-300">Diff√©rentiabilit√©:</span>
                                        <div class="flex items-center gap-2">
                                            <span class="text-lg ${data.allDifferentiable ? '‚úÖ' : '‚ö†Ô∏è'}">${data.allDifferentiable ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                                            <span class="font-semibold ${percentage >= 80 ? 'text-green-400' : percentage >= 60 ? 'text-yellow-400' : 'text-red-400'}">
                                                ${percentage}%
                                            </span>
                                        </div>
                                    </div>

                                    <div class="text-xs text-gray-400">
                                        ${passedDifferences}/${totalDifferences} paires de couleurs distinguables
                                    </div>

                                    ${data.simulatedColors ? `
                                        <div class="mt-3">
                                            <div class="text-xs text-gray-300 mb-2">Aper√ßu des couleurs simul√©es:</div>
                                            <div class="flex gap-1">
                                                ${Object.entries(data.simulatedColors).map(([status, colors]) => `
                                                    <div class="tooltip-wrapper" tabindex="0">
                                                        <div class="color-preview simulated" style="background-color: ${colors.simulated}" title="Couleur simul√©e"></div>
                                                        <div class="tooltip-box">
                                                            <div class="font-medium">${status}</div>
                                                            <div>Original: ${colors.original}</div>
                                                            <div>Simul√©: ${colors.simulated}</div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            // Fonction pour remplir l'analyse de diff√©rentiabilit√© avec onglets
            function populateDifferenceAnalysis() {
                const tabsContainer = document.getElementById('difference-tabs-container');
                const contentContainer = document.getElementById('difference-content');

                if (tabsContainer && contentContainer && daltonisme.daltonisme) {
                    const typeNames = {
                        protanopia: 'Protanopie',
                        deuteranopia: 'Deut√©ranopie',
                        tritanopia: 'Tritanopie',
                        achromatopsie: 'Achromatopsie'
                    };

                    const entries = Object.entries(daltonisme.daltonisme);

                    // Cr√©er les onglets
                    tabsContainer.innerHTML = entries.map(([type], index) => `
                        <button class="difference-type-tab ${index === 0 ? 'active' : ''} px-4 py-2 text-sm font-medium rounded-md transition-all bg-transparent text-gray-400 hover:bg-gray-700/30" data-type="${type}">
                            ${typeNames[type] || type}
                        </button>
                    `).join('');

                    // Cr√©er le contenu de chaque onglet
                    contentContainer.innerHTML = entries.map(([type, data], index) => {
                        const differences = data.differences || [];

                        return `
                            <div class="difference-type-content ${index === 0 ? 'active' : ''}" data-type-content="${type}">
                                <div class="grid grid-cols-1 gap-3">
                                    ${differences.map(diff => {
                                        const deltaClass = diff.differentiable ? 'delta-e-good' :
                                                         diff.deltaSimulated >= 30 ? 'delta-e-warning' : 'delta-e-critical';

                                        return `
                                            <div class="p-3 bg-gray-800/50 border border-gray-700/50 rounded-lg hover:border-gray-600/50 transition-colors">
                                                <div class="flex justify-between items-center mb-2">
                                                    <div class="text-sm font-medium text-gray-200">${diff.pair}</div>
                                                    <span class="text-lg">${diff.differentiable ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                                                </div>
                                                <div class="grid grid-cols-2 gap-3 text-xs">
                                                    <div class="p-2 bg-gray-700/30 rounded">
                                                        <div class="text-gray-500 mb-1">üëÅÔ∏è Vision normale</div>
                                                        <div class="font-mono text-blue-400 font-semibold">ŒîE: ${diff.deltaOriginal?.toFixed(1) || 'N/A'}</div>
                                                    </div>
                                                    <div class="p-2 bg-gray-700/30 rounded">
                                                        <div class="text-gray-500 mb-1">üëÅÔ∏è Vision daltonienne</div>
                                                        <div class="font-mono font-semibold ${diff.differentiable ? 'text-green-400' : 'text-red-400'}">ŒîE: ${diff.deltaSimulated?.toFixed(1) || 'N/A'}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('');

                    // Initialiser les onglets
                    initDifferenceTypeTabs();
                }
            }

            // Fonction pour g√©rer les onglets de types de daltonisme
            function initDifferenceTypeTabs() {
                const tabs = document.querySelectorAll('.difference-type-tab');
                const contents = document.querySelectorAll('.difference-type-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetType = tab.dataset.type;

                        // D√©sactiver tous les onglets et contenus
                        tabs.forEach(t => {
                            t.classList.remove('active', 'bg-purple-500', 'text-white');
                            t.classList.add('bg-transparent', 'text-gray-400');
                        });
                        contents.forEach(c => c.classList.remove('active'));

                        // Activer l'onglet et le contenu s√©lectionn√©s
                        tab.classList.add('active', 'bg-purple-500', 'text-white');
                        tab.classList.remove('bg-transparent', 'text-gray-400');
                        const content = document.querySelector(`[data-type-content="${targetType}"]`);
                        if (content) content.classList.add('active');
                    });
                });

                // Activer le premier onglet par d√©faut
                if (tabs.length > 0) {
                    tabs[0].classList.add('bg-purple-500', 'text-white');
                    tabs[0].classList.remove('bg-transparent', 'text-gray-400');
                }
            }

            // Fonction pour g√©rer les onglets datasets
            function initDatasetTabs() {
                const tabs = document.querySelectorAll('.dataset-tab');
                const contents = document.querySelectorAll('.dataset-tab-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetIndex = tab.dataset.datasetIndex;

                        // D√©sactiver tous les onglets et contenus
                        tabs.forEach(t => {
                            t.classList.remove('active', 'bg-purple-500', 'text-white');
                            t.classList.add('text-gray-400');
                        });
                        contents.forEach(c => c.classList.remove('active'));

                        // Activer l'onglet et le contenu s√©lectionn√©s
                        tab.classList.add('active', 'bg-purple-500', 'text-white');
                        tab.classList.remove('text-gray-400');
                        const content = document.querySelector(`[data-dataset-content="${targetIndex}"]`);
                        if (content) content.classList.add('active');
                    });
                });
            }

            // Fonction pour g√©rer les onglets FPS
            function initFpsTabs() {
                const tabs = document.querySelectorAll('.fps-tab');
                const contents = document.querySelectorAll('.fps-tab-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetIndex = tab.dataset.fpsIndex;

                        // D√©sactiver tous les onglets et contenus
                        tabs.forEach(t => {
                            t.classList.remove('active', 'bg-purple-500', 'text-white');
                            t.classList.add('text-gray-400');
                        });
                        contents.forEach(c => c.classList.remove('active'));

                        // Activer l'onglet et le contenu s√©lectionn√©s
                        tab.classList.add('active', 'bg-purple-500', 'text-white');
                        tab.classList.remove('text-gray-400');
                        const content = document.querySelector(`[data-fps-content="${targetIndex}"]`);
                        if (content) content.classList.add('active');
                    });
                });
            }

            // Mettre √† jour les m√©triques principales
            function updateMainMetrics() {
                const contrastScore = document.getElementById('contrast-score');
                const daltonismScore = document.getElementById('daltonism-score');
                const statusBadge = document.getElementById('daltonisme-status-badge');
                const globalSummary = document.getElementById('global-summary');

                if (contrastScore) {
                    const contrastPercent = stats.passed + stats.failed > 0 ?
                        Math.round((stats.passed / (stats.passed + stats.failed)) * 100) : 0;
                    contrastScore.textContent = `${contrastPercent}%`;
                }

                if (daltonismScore && daltonisme.daltonisme) {
                    const daltonismTypes = Object.values(daltonisme.daltonisme);

                    // Calculer le pourcentage moyen de diff√©rentiabilit√© pour tous les types
                    let totalPercent = 0;
                    let typesCount = 0;

                    daltonismTypes.forEach(type => {
                        if (type.differences && type.differences.length > 0) {
                            const differentiable = type.differences.filter(d => d.differentiable).length;
                            const total = type.differences.length;
                            const percent = (differentiable / total) * 100;
                            totalPercent += percent;
                            typesCount++;
                        }
                    });

                    const averagePercent = typesCount > 0 ? Math.round(totalPercent / typesCount) : 0;
                    daltonismScore.textContent = `${averagePercent}%`;
                }

                if (statusBadge) {
                    const overallStatus = (stats.passed > stats.failed) &&
                        Object.values(daltonisme.daltonisme || {}).every(d => d.allDifferentiable);
                    statusBadge.className = `text-xs px-3 py-1 rounded-full ${
                        overallStatus ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'
                    }`;
                    statusBadge.textContent = overallStatus ? '‚úÖ Conforme' : '‚ö†Ô∏è √Ä am√©liorer';
                }

                if (globalSummary) {
                    const totalTests = allTests.length;
                    const passedTests = stats.passed;
                    const daltonismTypes = Object.keys(daltonisme.daltonisme || {}).length;

                    globalSummary.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-blue-400">${totalTests}</div>
                                <div class="text-xs text-gray-400">Tests de contraste</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-purple-400">${daltonismTypes}</div>
                                <div class="text-xs text-gray-400">Types de daltonisme</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold ${passedTests > (totalTests - passedTests) ? 'text-green-400' : 'text-red-400'}">
                                    ${totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0}%
                                </div>
                                <div class="text-xs text-gray-400">Conformit√© globale</div>
                            </div>
                        </div>
                    `;
                }
            }

            const daltonismeContainer = document.getElementById("chart-daltonisme").parentElement;

            // D√©truire l'ancien graphique s'il existe
            const existingChart = Chart.getChart("chart-daltonisme");
            if (existingChart) {
                existingChart.destroy();
            }

            // Cr√©er le graphique en donut (plus petit maintenant)
            const daltonismeChart = new Chart(document.getElementById("chart-daltonisme"), {
                type: "doughnut",
                data: {
                    labels: ["Tests r√©ussis", "Tests √©chou√©s"],
                    datasets: [{
                        data: [stats.passed, stats.failed],
                        backgroundColor: ["#10b981", "#ef4444"],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = stats.passed + stats.failed;
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '50%'
                }
            });

            // Initialiser tous les composants de la section daltonisme
            setTimeout(() => {
                initDaltonismeTabs();
                populateStatusColors();
                populateContrastTests();
                populateSimulations();
                populateDifferenceAnalysis();
                updateMainMetrics();
            }, 100);

        } else {
            document.getElementById("chart-daltonisme").innerHTML =
                '<div class="flex items-center justify-center h-32 text-gray-400"><p>‚è≥ Test daltonisme en cours...</p></div>';
        }

        // FPS - Affichage enrichi avec explication et onglets
        const fpsEl = document.getElementById("fps-result");
        if (fps?.avgOverall != null && fps.tests && fps.tests.length > 0) {
            const avgFps = parseFloat(fps.avgOverall);
            const statusIcon = fps.allPassed ? '‚úÖ' : '‚ùå';
            const statusColor = fps.allPassed ? 'text-green-400' : 'text-red-400';
            const tests = fps.tests;
            const progressPercent = Math.min(100, (avgFps / 60) * 100);
            const strokeDasharray = `${progressPercent * 2.51} 251`;

            fpsEl.innerHTML = `
                <div class="space-y-4">
                    <!-- Explication FPS -->
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">üí°</div>
                            <div>
                                <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi le "FPS" ?</div>
                                <div class="text-xs text-gray-300 space-y-1">
                                    <p><strong>FPS</strong> = <strong>Frames Per Second</strong> (images par seconde). C'est le nombre d'images que l'√©cran affiche chaque seconde.</p>
                                    <p class="pt-2"><strong class="text-blue-400">60 FPS</strong> = Objectif pour des animations <strong>fluides</strong> et une exp√©rience utilisateur optimale. En dessous de 30 FPS, les animations deviennent <strong>saccad√©es</strong>.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- R√©sum√© avec gauge -->
                    <div class="flex items-center justify-between">
                        <div class="relative">
                            <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 84 84">
                                <circle cx="42" cy="42" r="40" stroke="rgba(255,255,255,0.1)" stroke-width="4" fill="none"/>
                                <circle cx="42" cy="42" r="40" stroke="${avgFps >= 60 ? '#10b981' : avgFps >= 45 ? '#f59e0b' : '#ef4444'}"
                                        stroke-width="4" fill="none" stroke-linecap="round"
                                        stroke-dasharray="${strokeDasharray}" class="transition-all duration-1000 ease-out"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-lg font-bold ${statusColor}">${avgFps.toFixed(0)}</div>
                                    <div class="text-xs text-gray-400">FPS</div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 ml-4 space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Performance globale</span>
                                <span class="text-2xl">${statusIcon}</span>
                            </div>
                            <div class="text-xs text-gray-300">${tests.length} sc√©narios test√©s</div>
                            <div class="text-xs ${fps.allPassed ? 'text-green-400' : 'text-red-400'}">
                                ${fps.allPassed ? 'Animations fluides ‚ú®' : 'Optimisation requise ‚ö†Ô∏è'}
                            </div>
                        </div>
                    </div>

                    <!-- Bar√®me -->
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-green-400 font-semibold">‚â• 60 FPS</div>
                            <div class="text-gray-400">Excellent</div>
                        </div>
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-yellow-400 font-semibold">45-60 FPS</div>
                            <div class="text-gray-400">Acceptable</div>
                        </div>
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-red-400 font-semibold">< 45 FPS</div>
                            <div class="text-gray-400">Probl√©matique</div>
                        </div>
                    </div>

                    <!-- Navigation onglets sc√©narios FPS -->
                    <div class="mb-4">
                        <div class="text-sm font-medium text-gray-200 mb-2">üìä R√©sultats d√©taill√©s par sc√©nario</div>
                        <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg" id="fps-tabs-container">
                            ${tests.map((test, index) => {
                                const isFirst = index === 0;
                                const shortName = test.testName.split('(')[0].trim();
                                return `
                                    <button class="fps-tab ${isFirst ? 'active bg-purple-500 text-white' : 'text-gray-400 hover:text-white hover:bg-gray-700'}
                                            px-2 py-1.5 rounded text-xs font-medium transition-colors"
                                            data-fps-index="${index}">
                                        ${shortName}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Contenu des onglets FPS -->
                    <div id="fps-content-tabs">
                        ${tests.map((test, index) => {
                            const isFirst = index === 0;
                            const fpsStatus = test.passed ? 'text-green-400' : 'text-red-400';
                            const fpsIcon = test.passed ? '‚úÖ' : '‚ùå';
                            const statusBg = test.passed ? 'bg-green-500/10 border-green-500/30' : 'bg-red-500/10 border-red-500/30';

                            return `
                                <div class="fps-tab-content ${isFirst ? 'active' : ''}" data-fps-content="${index}">
                                    <div class="p-4 ${statusBg} border rounded-lg space-y-3">
                                        <!-- En-t√™te -->
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="text-sm font-semibold text-gray-200">${test.testName}</div>
                                                <div class="text-xs text-gray-400">Sc√©nario ${index + 1}/${tests.length}</div>
                                            </div>
                                            <div class="text-3xl">${fpsIcon}</div>
                                        </div>

                                        <!-- FPS grid 3 colonnes -->
                                        <div class="grid grid-cols-3 gap-3 text-center">
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Moyen</div>
                                                <div class="text-lg font-bold ${fpsStatus}">${test.avgFPS.toFixed(1)}</div>
                                            </div>
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Min</div>
                                                <div class="text-sm font-semibold text-gray-300">${test.minFPS}</div>
                                            </div>
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Max</div>
                                                <div class="text-sm font-semibold text-gray-300">${test.maxFPS}</div>
                                            </div>
                                        </div>

                                        <!-- D√©tails -->
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Frames mesur√©es</span>
                                            <span class="font-semibold text-gray-300">${test.frameCount} frames</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Seuil minimum requis</span>
                                            <span class="font-semibold text-gray-300">55 FPS</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Moyenne globale -->
                    <div class="p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-purple-300">Moyenne globale</span>
                            <span class="text-lg font-bold text-purple-400">${avgFps.toFixed(1)} FPS</span>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">Sur ${tests.length} sc√©narios d'utilisation test√©s</div>
                    </div>
                </div>
            `;

            // Initialiser les onglets FPS
            setTimeout(() => initFpsTabs(), 100);
        } else {
            fpsEl.innerHTML = `
                <div class="flex items-center justify-center h-32">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto mb-2"></div>
                        <p class="text-gray-400 text-sm">Tests FPS en cours...</p>
                    </div>
                </div>
            `;
        }

        // Mettre √† jour le badge de statut FPS
        const fpsStatusBadge = document.getElementById('fps-status-badge');
        if (fpsStatusBadge && fps?.avgOverall != null) {
            const avgFps = parseFloat(fps.avgOverall);
            const allPassed = fps.allPassed;
            fpsStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                allPassed ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
            }`;
            fpsStatusBadge.textContent = allPassed ? `‚úÖ ${avgFps.toFixed(0)} FPS` : `‚ö†Ô∏è ${avgFps.toFixed(0)} FPS`;
        }

        // A11y - Affichage am√©lior√© avec explications
        const a11yEl = document.getElementById("a11y-result");
        if (a11y != null) {
            const passed = a11y.allPassed || a11y.passed || false;
            const statusIcon = passed ? '‚úÖ' : '‚ùå';
            const statusColor = passed ? 'text-green-400' : 'text-red-400';
            const badgeColor = passed ? 'bg-green-500' : 'bg-red-500';
            const statusText = passed ? 'Conforme' : 'Non conforme';
            const notes = a11y.notes || [];

            a11yEl.innerHTML = `
                <div class="space-y-4">
                    <!-- Statut principal -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 ${badgeColor} rounded-full flex items-center justify-center text-white text-xl font-bold">
                                ${passed ? '‚ôø' : '‚ö†Ô∏è'}
                            </div>
                            <div>
                                <div class="text-lg font-bold ${statusColor}">${statusText}</div>
                                <div class="text-xs text-gray-400">Reduced Motion</div>
                            </div>
                        </div>
                        <div class="text-3xl">${statusIcon}</div>
                    </div>

                    <!-- Explication "C'est quoi ?" -->
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">üí°</div>
                            <div>
                                <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi "Reduced Motion" ?</div>
                                <div class="text-xs text-gray-300 space-y-1">
                                    <p>Certaines personnes ont des troubles vestibulaires (oreille interne) ou sont sensibles aux mouvements √† l'√©cran : animations, parallax, transitions peuvent provoquer naus√©es, vertiges ou migraines.</p>
                                    <p class="pt-2"><strong class="text-blue-400">La directive CSS <code class="bg-gray-800 px-1 rounded">prefers-reduced-motion</code></strong> permet aux utilisateurs d'indiquer qu'ils pr√©f√®rent des animations r√©duites ou absentes.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- D√©tails du test -->
                    <div class="p-3 bg-gray-800 rounded-lg">
                        <div class="text-sm font-medium text-gray-200 mb-2">üìä R√©sultats du test</div>
                        ${notes.length > 0 ? `
                            <ul class="space-y-1 text-xs text-gray-300">
                                ${notes.map(note => `<li class="flex items-start gap-2">
                                    <span class="${note.includes('conforme') || note.includes('Aucun') ? 'text-green-400' : 'text-orange-400'}">‚Ä¢</span>
                                    <span>${note}</span>
                                </li>`).join('')}
                            </ul>
                        ` : `
                            <div class="text-xs text-gray-400">
                                ${passed ?
                                    '‚úÖ Les animations respectent prefers-reduced-motion' :
                                    '‚ùó Certaines animations ne respectent pas les pr√©f√©rences utilisateur'
                                }
                            </div>
                        `}
                    </div>

                    ${!passed ? `
                        <!-- Recommandations si non conforme -->
                        <div class="p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                            <div class="flex items-start gap-3">
                                <div class="text-2xl">üîß</div>
                                <div>
                                    <div class="text-sm font-semibold text-red-300 mb-2">Comment corriger ?</div>
                                    <div class="text-xs text-gray-300 space-y-2">
                                        <p><strong>1. CSS :</strong> D√©sactiver ou r√©duire les animations</p>
                                        <pre class="bg-gray-900 p-2 rounded mt-1 overflow-x-auto"><code class="text-xs text-green-300">@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}</code></pre>

                                        <p class="pt-2"><strong>2. Framer Motion :</strong> Utiliser <code class="bg-gray-800 px-1 rounded">MotionConfig</code></p>
                                        <pre class="bg-gray-900 p-2 rounded mt-1 overflow-x-auto"><code class="text-xs text-green-300">import { MotionConfig } from 'framer-motion';

&lt;MotionConfig reducedMotion="user"&gt;
  {/* Vos animations ici */}
&lt;/MotionConfig&gt;</code></pre>

                                        <p class="pt-2"><strong>3. JavaScript :</strong> D√©tecter la pr√©f√©rence utilisateur</p>
                                        <pre class="bg-gray-900 p-2 rounded mt-1 overflow-x-auto"><code class="text-xs text-green-300">const prefersReducedMotion =
  window.matchMedia('(prefers-reduced-motion: reduce)').matches;

if (!prefersReducedMotion) {
  // Animations normales
}</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <!-- Statut final -->
                    ${passed ?
                        '<div class="flex items-center space-x-2 text-xs text-green-400"><span class="pulse-dot bg-green-400"></span><span>Accessibilit√© optimis√©e</span></div>' :
                        '<div class="flex items-center space-x-2 text-xs text-red-400"><span class="pulse-dot bg-red-400"></span><span>Am√©liorations n√©cessaires</span></div>'
                    }
                </div>
            `;
        } else {
            a11yEl.innerHTML = `
                <div class="flex items-center justify-center h-32">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto mb-2"></div>
                        <p class="text-gray-400 text-sm">Test accessibilit√© en cours...</p>
                    </div>
                </div>
            `;
        }

        // Mettre √† jour le badge de statut A11y
        const a11yStatusBadge = document.getElementById('a11y-status-badge');
        if (a11yStatusBadge && a11y != null) {
            const passed = a11y.allPassed || a11y.passed || a11y.success || false;
            a11yStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                passed ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
            }`;
            a11yStatusBadge.textContent = passed ? '‚úÖ Conforme' : '‚ùå Non conforme';
        }

        // Datasets - Affichage enrichi avec calcul de d√©gradation
        const datasetEl = document.getElementById("dataset-result");

        // Si on a des tests d√©taill√©s, calculer et afficher
        if (datasets?.tests && datasets.tests.length > 0) {
            const tests = datasets.tests;
            const validTests = tests.filter(t => t.avgFPS > 0);

            // Calculer la d√©gradation (diff√©rence entre premier et dernier test)
            let degradation = 0;
            if (validTests.length >= 2) {
                const firstFPS = validTests[0].avgFPS;
                const lastFPS = validTests[validTests.length - 1].avgFPS;
                degradation = ((firstFPS - lastFPS) / firstFPS) * 100;
            }

            const isGood = degradation < 5;
            const isMedium = degradation < 15;
            const statusIcon = isGood ? '‚úÖ' : isMedium ? '‚ö†Ô∏è' : '‚ùå';
            const statusColor = isGood ? 'text-green-400' : isMedium ? 'text-yellow-400' : 'text-red-400';
            const gaugeColor = isGood ? '#10b981' : isMedium ? '#f59e0b' : '#ef4444';
            const statusText = isGood ? 'Excellente' : isMedium ? 'Acceptable' : 'Probl√©matique';
            const gaugePercent = Math.min(100, (Math.abs(degradation) / 20) * 100);
            const gaugeDasharray = `${gaugePercent * 1.88} 188`;

            const avgOverall = datasets.avgOverall || (validTests.reduce((sum, t) => sum + t.avgFPS, 0) / validTests.length);

            datasetEl.innerHTML = `
                <div class="space-y-4">
                    <!-- Explication de la scalabilit√© -->
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">üí°</div>
                            <div>
                                <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi la "Scalabilit√©" ?</div>
                                <div class="text-xs text-gray-300 space-y-1">
                                    <p>La scalabilit√© mesure comment l'application <strong>maintient ses performances</strong> quand la quantit√© de donn√©es augmente.</p>
                                    <p class="pt-2"><strong class="text-blue-400">Ici</strong> : On teste avec <strong>5, 50, 200 et 500 stocks</strong> pour voir si les animations restent fluides (60 FPS) m√™me avec beaucoup de cartes produits.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- R√©sum√© avec gauge -->
                    <div class="flex items-center justify-between">
                        <div class="relative">
                            <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 64 64">
                                <circle cx="32" cy="32" r="30" stroke="rgba(255,255,255,0.1)" stroke-width="4" fill="none"/>
                                <circle cx="32" cy="32" r="30" stroke="${gaugeColor}"
                                        stroke-width="4" fill="none" stroke-linecap="round"
                                        stroke-dasharray="${gaugeDasharray}" class="transition-all duration-1000 ease-out"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-sm font-bold ${statusColor}">${Math.abs(degradation).toFixed(1)}%</div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 ml-4 space-y-1">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">D√©gradation des performances</span>
                                <span class="text-2xl">${statusIcon}</span>
                            </div>
                            <div class="text-xs ${statusColor} font-medium">Scalabilit√© ${statusText.toLowerCase()}</div>
                            <div class="text-xs text-gray-400">De ${validTests[0]?.datasetCount || '?'} √† ${validTests[validTests.length - 1]?.datasetCount || '?'} stocks</div>
                        </div>
                    </div>

                    <!-- Bar√®me de r√©f√©rence -->
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-green-400 font-semibold">< 5%</div>
                            <div class="text-gray-400">Excellente</div>
                        </div>
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-yellow-400 font-semibold">5-15%</div>
                            <div class="text-gray-400">Acceptable</div>
                        </div>
                        <div class="p-2 bg-gray-800 rounded">
                            <div class="text-red-400 font-semibold">> 15%</div>
                            <div class="text-gray-400">Probl√©matique</div>
                        </div>
                    </div>

                    <!-- Navigation onglets datasets -->
                    <div class="mb-4">
                        <div class="text-sm font-medium text-gray-200 mb-2">üìä R√©sultats d√©taill√©s par taille</div>
                        <div class="flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg" id="dataset-tabs-container">
                            ${tests.map((test, index) => {
                                const isFirst = index === 0;
                                return `
                                    <button class="dataset-tab ${isFirst ? 'active bg-purple-500 text-white' : 'text-gray-400 hover:text-white hover:bg-gray-700'}
                                            px-3 py-1.5 rounded text-xs font-medium transition-colors"
                                            data-dataset-index="${index}">
                                        ${test.datasetCount} stocks
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Contenu des onglets datasets -->
                    <div id="dataset-content-tabs" class="mb-4">
                        ${tests.map((test, index) => {
                            const isFirst = index === 0;
                            const fpsStatus = test.passed ? 'text-green-400' : 'text-red-400';
                            const fpsIcon = test.passed ? '‚úÖ' : '‚ùå';
                            const statusBg = test.passed ? 'bg-green-500/10 border-green-500/30' : 'bg-red-500/10 border-red-500/30';

                            return `
                                <div class="dataset-tab-content ${isFirst ? 'active' : ''}" data-dataset-content="${index}">
                                    <div class="p-4 ${statusBg} border rounded-lg space-y-3">
                                        <!-- En-t√™te -->
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="text-sm font-semibold text-gray-200">${test.datasetName}</div>
                                                <div class="text-xs text-gray-400">${test.datasetCount} cartes produits charg√©es</div>
                                            </div>
                                            <div class="text-3xl">${fpsIcon}</div>
                                        </div>

                                        <!-- FPS principal -->
                                        <div class="grid grid-cols-3 gap-3 text-center">
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Moyen</div>
                                                <div class="text-lg font-bold ${fpsStatus}">${test.avgFPS.toFixed(1)}</div>
                                            </div>
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Min</div>
                                                <div class="text-sm font-semibold text-gray-300">${test.minFPS}</div>
                                            </div>
                                            <div class="p-2 bg-gray-800/50 rounded">
                                                <div class="text-xs text-gray-400 mb-1">FPS Max</div>
                                                <div class="text-sm font-semibold text-gray-300">${test.maxFPS}</div>
                                            </div>
                                        </div>

                                        <!-- Seuil -->
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Seuil minimum requis</span>
                                            <span class="font-semibold text-gray-300">55 FPS</span>
                                        </div>

                                        <!-- Nombre de frames mesur√©es -->
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Frames mesur√©es</span>
                                            <span class="font-semibold text-gray-300">${test.frameCount || 'N/A'} frames</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Moyenne globale -->
                    <div class="p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-purple-300">Moyenne globale</span>
                            <span class="text-lg font-bold text-purple-400">${avgOverall.toFixed(1)} FPS</span>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">Sur ${tests.length} tailles de datasets test√©es</div>
                    </div>
                </div>
            `;

            // Initialiser les onglets datasets
            setTimeout(() => initDatasetTabs(), 100);
        }
        // Sinon afficher le message "donn√©es manquantes"
        else {
            datasetEl.innerHTML = `
                <div class="space-y-4">
                    <!-- Explication de la scalabilit√© (m√™me sans donn√©es) -->
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">üí°</div>
                            <div>
                                <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi la "Scalabilit√©" ?</div>
                                <div class="text-xs text-gray-300 space-y-1">
                                    <p>La scalabilit√© mesure comment l'application <strong>maintient ses performances</strong> quand la quantit√© de donn√©es augmente.</p>
                                    <p class="pt-2"><strong class="text-blue-400">Ce test</strong> : Mesure les FPS avec <strong>5, 50, 200 et 500 stocks</strong> pour voir si les animations restent fluides m√™me avec beaucoup de donn√©es.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center">
                            <span class="text-2xl">üîç</span>
                        </div>
                        <div class="flex-1 ml-4 space-y-1">
                            <div class="text-lg font-bold text-gray-400">Donn√©es manquantes</div>
                            <div class="text-xs text-gray-500">Tests de scalabilit√© non ex√©cut√©s</div>
                        </div>
                    </div>
                    <div class="p-3 bg-gray-800 rounded-lg border border-dashed border-gray-600">
                        <div class="text-xs text-gray-400 text-center">
                            Ex√©cutez <code class="bg-gray-700 px-1 rounded">npm run audit:datasets</code> pour g√©n√©rer les m√©triques
                        </div>
                    </div>
                </div>
            `;
        }

        // Mettre √† jour le badge de statut Datasets
        const datasetsStatusBadge = document.getElementById('datasets-status-badge');
        if (datasetsStatusBadge && datasets) {
            // Si on a des tests, calculer la d√©gradation
            if (datasets.tests && datasets.tests.length > 0) {
                const validTests = datasets.tests.filter(t => t.avgFPS > 0);

                // Calculer la d√©gradation
                let degradation = 0;
                if (validTests.length >= 2) {
                    const firstFPS = validTests[0].avgFPS;
                    const lastFPS = validTests[validTests.length - 1].avgFPS;
                    degradation = ((firstFPS - lastFPS) / firstFPS) * 100;
                }

                const isGood = degradation < 5;
                const isMedium = degradation < 15;
                datasetsStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                    isGood ? 'bg-green-500/20 text-green-400' :
                    isMedium ? 'bg-yellow-500/20 text-yellow-400' :
                    'bg-red-500/20 text-red-400'
                }`;
                datasetsStatusBadge.textContent = isGood ? '‚úÖ Excellente' : isMedium ? '‚ö†Ô∏è Acceptable' : '‚ùå Probl√©matique';
            }
            // Fallback : champ degradation direct (ancien format)
            else if (datasets.degradation != null && datasets.degradation !== 'N/A') {
                const degradation = parseFloat(datasets.degradation);
                const isGood = degradation < 5;
                const isMedium = degradation < 15;
                datasetsStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                    isGood ? 'bg-green-500/20 text-green-400' :
                    isMedium ? 'bg-yellow-500/20 text-yellow-400' :
                    'bg-red-500/20 text-red-400'
                }`;
                datasetsStatusBadge.textContent = isGood ? '‚úÖ Excellente' : isMedium ? '‚ö†Ô∏è Acceptable' : '‚ùå Probl√©matique';
            }
            // Fallback : allPassed simple
            else if (datasets.allPassed != null) {
                const avgFps = datasets.avgOverall ? parseFloat(datasets.avgOverall) : 60;
                datasetsStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                    datasets.allPassed ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
                }`;
                datasetsStatusBadge.textContent = datasets.allPassed ? `‚úÖ ${avgFps.toFixed(0)} FPS` : '‚ùå √âchou√©s';
            }
        }
    }

    function renderAudit(audit) {
        if (!audit) {
            document.getElementById('rncp-overview').innerHTML = '<p class="mt-2 text-yellow-400 text-xs">Impossible de charger audit-complet.</p>';
            return;
        }

        // Stocker l'audit pour le t√©l√©chargement
        currentAudit = audit;

        // Calculer le score global
        let score = 0;
        let totalMetrics = 0;

        if (audit.lighthouse?.scores?.performance != null) {
            score += audit.lighthouse.scores.performance;
            totalMetrics++;
        }
        if (audit.lighthouse?.scores?.accessibility != null) {
            score += audit.lighthouse.scores.accessibility;
            totalMetrics++;
        }
        if (audit.fps?.allPassed != null) {
            score += audit.fps.allPassed ? 100 : 50;
            totalMetrics++;
        }
        // Utiliser statements ou lines selon disponibilit√©
        const coverageScore = audit.coverage?.statements || audit.coverage?.lines || 0;
        if (coverageScore > 0) {
            score += coverageScore;
            totalMetrics++;
        }

        const avgScore = totalMetrics > 0 ? score / totalMetrics : 0;
        const isExcellent = avgScore >= 85;
        const isGood = avgScore >= 70;

        // Mettre √† jour le badge de statut
        const auditRncpStatusBadge = document.getElementById('audit-rncp-status-badge');
        if (auditRncpStatusBadge) {
            auditRncpStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                isExcellent ? 'bg-green-500/20 text-green-400' :
                isGood ? 'bg-yellow-500/20 text-yellow-400' :
                'bg-red-500/20 text-red-400'
            }`;
            auditRncpStatusBadge.textContent = isExcellent ? `‚úÖ ${avgScore.toFixed(0)}%` : isGood ? `‚ö†Ô∏è ${avgScore.toFixed(0)}%` : `‚ùå ${avgScore.toFixed(0)}%`;
        }

        // === VUE D'ENSEMBLE ===
        const perfScore = audit.lighthouse?.scores?.performance || 0;
        const a11yScore = audit.lighthouse?.scores?.accessibility || 0;
        const qualityScore = audit.coverage?.statements || audit.coverage?.lines || 0;
        const fpsScore = audit.fps?.allPassed ? 100 : (audit.fps?.avgOverall ? (audit.fps.avgOverall / 60) * 100 : 0);

        document.getElementById('rncp-overview').innerHTML = `
            <!-- Explication RNCP -->
            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-6">
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üí°</div>
                    <div>
                        <div class="text-sm font-semibold text-blue-300 mb-2">C'est quoi l'audit RNCP ?</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            <p>L'<strong>audit RNCP</strong> agr√®ge tous les audits de qualit√© (Performance, Accessibilit√©, √âco-conception, Qualit√© du code) pour d√©montrer les comp√©tences acquises dans le cadre du <strong>RNCP niveau 7</strong> (Bac+5).</p>
                            <p class="pt-2">Cet audit v√©rifie la conformit√© du projet selon les standards professionnels : <strong>Lighthouse</strong>, <strong>WCAG</strong>, <strong>performances FPS</strong>, et <strong>couverture de tests</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scores globaux avec gauges -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                ${createScoreGauge('Performance', perfScore, '‚ö°')}
                ${createScoreGauge('Accessibilit√©', a11yScore, '‚ôø')}
                ${createScoreGauge('Qualit√©', qualityScore, 'üíé')}
                ${createScoreGauge('FPS', fpsScore, 'üé¨')}
            </div>

            <!-- Score moyen -->
            <div class="text-center p-6 bg-gradient-to-br from-purple-500/20 to-blue-500/20 rounded-lg border border-purple-500/30">
                <div class="text-5xl font-bold ${isExcellent ? 'text-green-400' : isGood ? 'text-yellow-400' : 'text-red-400'}">
                    ${avgScore.toFixed(0)}%
                </div>
                <div class="text-sm text-gray-300 mt-2">Score moyen RNCP</div>
                <div class="text-xs text-gray-400 mt-1">Bas√© sur ${totalMetrics} m√©triques</div>
            </div>

            <!-- T√©l√©chargement audit complet -->
            <div class="mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-gray-300">üì• T√©l√©charger l'audit complet</div>
                        <div class="text-xs text-gray-400 mt-1">Fichier JSON avec toutes les m√©triques d√©taill√©es</div>
                    </div>
                    <button onclick="downloadAuditJSON()"
                            class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2">
                        <span>üìÑ</span>
                        <span>T√©l√©charger JSON</span>
                    </button>
                </div>
            </div>

            <p class='mt-4 text-xs opacity-50 text-center'>Derni√®re mise √† jour : ${new Date(audit.timestamp).toLocaleString('fr-FR')}</p>
        `;

        // === PERFORMANCE ===
        const perfLighthouse = audit.lighthouse?.scores?.performance || 0;
        const avgFps = audit.fps?.avgOverall || 0;
        const degradation = audit.datasets?.degradation || 0;
        const fpsStatus = audit.fps?.allPassed;

        document.getElementById('rncp-performance').innerHTML = `
            <!-- Explication Performance -->
            <div class="p-4 bg-orange-500/10 border border-orange-500/30 rounded-lg mb-6">
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üí°</div>
                    <div>
                        <div class="text-sm font-semibold text-orange-300 mb-2">Pourquoi la performance est importante ?</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            <p>Une application <strong>performante</strong> am√©liore l'exp√©rience utilisateur et r√©duit la consommation d'√©nergie.</p>
                            <p class="pt-2">Les audits mesurent : <strong>temps de chargement</strong> (Lighthouse), <strong>fluidit√© des animations</strong> (FPS ‚â• 60), et <strong>d√©gradation des performances</strong> (datasets).</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Lighthouse Performance -->
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm font-medium">‚ö° Lighthouse Performance</div>
                        <div class="text-2xl font-bold ${perfLighthouse >= 90 ? 'text-green-400' : perfLighthouse >= 50 ? 'text-yellow-400' : 'text-red-400'}">
                            ${perfLighthouse}%
                        </div>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-1000"
                             style="width: ${perfLighthouse}%; background: ${perfLighthouse >= 90 ? '#10b981' : perfLighthouse >= 50 ? '#f59e0b' : '#ef4444'}"></div>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">
                        ${perfLighthouse >= 90 ? '‚úÖ Excellent' : perfLighthouse >= 50 ? '‚ö†Ô∏è √Ä am√©liorer' : '‚ùå Critique'}
                    </div>
                </div>

                <!-- FPS Moyen -->
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm font-medium">üé¨ FPS Moyen</div>
                        <div class="text-2xl font-bold ${avgFps >= 60 ? 'text-green-400' : avgFps >= 45 ? 'text-yellow-400' : 'text-red-400'}">
                            ${avgFps.toFixed(0)} FPS
                        </div>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-1000"
                             style="width: ${Math.min(100, (avgFps / 60) * 100)}%; background: ${avgFps >= 60 ? '#10b981' : avgFps >= 45 ? '#f59e0b' : '#ef4444'}"></div>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">
                        ${fpsStatus ? '‚úÖ Animations fluides' : '‚ö†Ô∏è Optimisation requise'} ‚Ä¢ Objectif : 60 FPS
                    </div>
                </div>

                ${degradation > 0 ? `
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm font-medium">üìä D√©gradation Datasets</div>
                        <div class="text-2xl font-bold ${degradation < 10 ? 'text-green-400' : degradation < 30 ? 'text-yellow-400' : 'text-red-400'}">
                            ${degradation}%
                        </div>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${degradation < 10 ? '‚úÖ Impact minimal' : degradation < 30 ? '‚ö†Ô∏è Impact mod√©r√©' : '‚ùå Impact significatif'}
                    </div>
                </div>
                ` : ''}

                <!-- T√©l√©chargement -->
                <div class="mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-medium text-gray-300">üì• T√©l√©charger l'audit Performance</div>
                            <div class="text-xs text-gray-400 mt-1">Fichier JSON avec m√©triques de performance d√©taill√©es</div>
                        </div>
                        <button onclick="downloadAuditJSON('performance')"
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2">
                            <span>üìÑ</span>
                            <span>T√©l√©charger</span>
                        </button>
                    </div>
                </div>
            </div>
        `;

        // === ACCESSIBILIT√â ===
        const a11yLighthouse = audit.lighthouse?.scores?.accessibility || 0;
        const reducedMotion = audit.a11y?.passed;
        const wcagData = audit.riskLevels;

        document.getElementById('rncp-accessibility').innerHTML = `
            <!-- Explication Accessibilit√© -->
            <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-lg mb-6">
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üí°</div>
                    <div>
                        <div class="text-sm font-semibold text-green-300 mb-2">Pourquoi l'accessibilit√© est essentielle ?</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            <p>L'<strong>accessibilit√© num√©rique</strong> garantit que tous les utilisateurs, y compris ceux en situation de handicap, peuvent utiliser l'application.</p>
                            <p class="pt-2">Les audits v√©rifient : <strong>contrastes WCAG</strong>, <strong>navigation clavier</strong>, <strong>ARIA</strong>, <strong>daltonisme</strong>, et <strong>reduced motion</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Lighthouse Accessibility -->
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-sm font-medium">‚ôø Lighthouse Accessibility</div>
                        <div class="text-2xl font-bold ${a11yLighthouse >= 90 ? 'text-green-400' : a11yLighthouse >= 50 ? 'text-yellow-400' : 'text-red-400'}">
                            ${a11yLighthouse}%
                        </div>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-1000"
                             style="width: ${a11yLighthouse}%; background: ${a11yLighthouse >= 90 ? '#10b981' : a11yLighthouse >= 50 ? '#f59e0b' : '#ef4444'}"></div>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">
                        ${a11yLighthouse >= 90 ? '‚úÖ Excellent' : a11yLighthouse >= 50 ? '‚ö†Ô∏è √Ä am√©liorer' : '‚ùå Critique'}
                    </div>
                </div>

                ${reducedMotion !== undefined ? `
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div class="text-sm font-medium">üé≠ Reduced Motion</div>
                        <div class="text-xl">${reducedMotion ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">
                        ${reducedMotion ? 'Conforme - Animations r√©duites disponibles' : 'Non conforme - Support √† ajouter'}
                    </div>
                </div>
                ` : ''}

                ${wcagData ? `
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm font-medium mb-3">üé® Contrastes WCAG (Risk Levels)</div>
                    <div class="grid grid-cols-2 gap-3 text-xs">
                        <div class="flex items-center justify-between p-2 bg-red-500/10 rounded">
                            <span>üî¥ Critique</span>
                            <span class="font-bold">${wcagData.critique || 0}</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-orange-500/10 rounded">
                            <span>üü† √âlev√©</span>
                            <span class="font-bold">${wcagData.eleve || 0}</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-yellow-500/10 rounded">
                            <span>üü° Moyen</span>
                            <span class="font-bold">${wcagData.moyen || 0}</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-green-500/10 rounded">
                            <span>üü¢ Faible</span>
                            <span class="font-bold">${wcagData.faible || 0}</span>
                        </div>
                    </div>
                </div>
                ` : ''}

                ${audit.daltonisme?.daltonisme ? `
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm font-medium mb-3">üëÅ Tests Daltonisme</div>
                    <div class="text-xs text-gray-300 space-y-2">
                        ${Object.entries(audit.daltonisme.daltonisme).map(([type, data]) =>
                            `<div class="flex items-center justify-between p-2 bg-gray-700/50 rounded">
                                <div>
                                    <div class="font-medium">${type === 'protanopia' ? 'Protanopie' : type === 'deuteranopia' ? 'Deut√©ranopie' : type === 'tritanopia' ? 'Tritanopie' : 'Achromatopsie'}</div>
                                    <div class="text-[10px] text-gray-400">${data.description}</div>
                                </div>
                                <span class="text-lg">${data.allDifferentiable ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                            </div>`
                        ).join('')}
                    </div>
                    ${audit.daltonisme.recommandations?.length > 0 ? `
                        <div class="mt-3 p-2 bg-blue-500/10 border border-blue-500/30 rounded text-[10px] text-gray-300">
                            <div class="font-semibold mb-1">üí° Compensations :</div>
                            ${audit.daltonisme.recommandations.map(r =>
                                `<div>‚Ä¢ ${r.solution}</div>`
                            ).join('')}
                        </div>
                    ` : ''}
                </div>
                ` : ''}

                <!-- T√©l√©chargement -->
                <div class="mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-medium text-gray-300">üì• T√©l√©charger l'audit Accessibilit√©</div>
                            <div class="text-xs text-gray-400 mt-1">Fichier JSON avec m√©triques d'accessibilit√© d√©taill√©es</div>
                        </div>
                        <button onclick="downloadAuditJSON('accessibility')"
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2">
                            <span>üìÑ</span>
                            <span>T√©l√©charger</span>
                        </button>
                    </div>
                </div>
            </div>
        `;

        // === √âCO-CONCEPTION ===
        const ecoData = audit.eco;
        const buildSuccess = ecoData?.build?.succeeded;
        const requestsPassed = ecoData?.requests?.passed;
        const requestCount = ecoData?.requests?.count || 0;
        const bestPractices = ecoData?.bestPractices || [];
        const ecoNotes = ecoData?.notes || [];

        document.getElementById('rncp-eco').innerHTML = `
            <!-- Explication √âco-conception -->
            <div class="p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg mb-6">
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üí°</div>
                    <div>
                        <div class="text-sm font-semibold text-emerald-300 mb-2">C'est quoi l'√©co-conception web ?</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            <p>L'<strong>√©co-conception</strong> vise √† r√©duire l'impact environnemental des applications web : <strong>r√©duction du poids</strong>, <strong>optimisation des ressources</strong>, et <strong>consommation √©nerg√©tique minimale</strong>.</p>
                            <p class="pt-2">Indicateurs : <strong>taille du bundle</strong>, <strong>nombre de requ√™tes</strong>, <strong>optimisation des images</strong>, et <strong>cache HTTP</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>

            ${ecoData ? `
                <div class="space-y-4">
                    <!-- Statut Build -->
                    <div class="p-4 bg-gray-800/50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="text-sm font-medium">üî® Build Production</div>
                            <div class="text-xl">${buildSuccess ? '‚úÖ' : '‚ùå'}</div>
                        </div>
                        <div class="text-xs text-gray-400 mt-2">
                            ${buildSuccess ? 'Build r√©ussi - Application pr√™te pour production' : '√âchec du build'}
                        </div>
                    </div>

                    <!-- Requ√™tes HTTP -->
                    <div class="p-4 bg-gray-800/50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm font-medium">üåê Requ√™tes HTTP</div>
                            <div class="text-xl font-bold ${requestsPassed ? 'text-green-400' : 'text-yellow-400'}">
                                ${requestCount}
                            </div>
                        </div>
                        <div class="text-xs text-gray-400">
                            ${requestsPassed ? '‚úÖ Nombre de requ√™tes optimal' : '‚ö†Ô∏è Trop de requ√™tes'}
                        </div>
                    </div>

                    ${bestPractices.length > 0 ? `
                    <!-- Bonnes pratiques -->
                    <div class="p-4 bg-gray-800/50 rounded-lg">
                        <div class="text-sm font-medium mb-3">‚ú® Bonnes Pratiques √âco-conception</div>
                        <div class="space-y-2 text-xs">
                            ${bestPractices.map(practice =>
                                `<div class="flex items-start gap-2 p-2 bg-gray-700/50 rounded">
                                    <span class="text-lg">${practice.ok ? '‚úÖ' : '‚ùå'}</span>
                                    <div class="flex-1">
                                        <div class="font-medium">${practice.name}</div>
                                        <div class="text-gray-400 text-[10px] mt-0.5">${practice.info}</div>
                                    </div>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                    ` : ''}

                    ${ecoNotes.length > 0 ? `
                    <!-- Notes et am√©liorations -->
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-medium mb-2">üìù Notes</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            ${ecoNotes.map(note => `<div>‚Ä¢ ${note}</div>`).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- R√©sum√© -->
                    <div class="p-4 bg-gradient-to-br from-emerald-500/20 to-green-500/20 rounded-lg border border-emerald-500/30 text-center">
                        <div class="text-3xl font-bold ${ecoData.success ? 'text-green-400' : 'text-yellow-400'}">
                            ${ecoData.success ? '‚úÖ' : '‚ö†Ô∏è'}
                        </div>
                        <div class="text-sm text-gray-300 mt-2">
                            ${ecoData.success ? 'Audit √©co-conception r√©ussi' : 'Am√©liorations possibles'}
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            ${bestPractices.filter(p => p.ok).length}/${bestPractices.length} bonnes pratiques appliqu√©es
                        </div>
                    </div>
                </div>

                <!-- T√©l√©chargement -->
                <div class="mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-medium text-gray-300">üì• T√©l√©charger l'audit √âco-conception</div>
                            <div class="text-xs text-gray-400 mt-1">Fichier JSON avec m√©triques d'√©co-conception d√©taill√©es</div>
                        </div>
                        <button onclick="downloadAuditJSON('eco')"
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2">
                            <span>üìÑ</span>
                            <span>T√©l√©charger</span>
                        </button>
                    </div>
                </div>
            ` : `
                <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">‚ö†Ô∏è</div>
                        <div class="text-sm text-yellow-300">
                            Donn√©es d'√©co-conception non disponibles. Ex√©cutez un audit √©co-conception pour obtenir ces m√©triques.
                        </div>
                    </div>
                </div>
            `}
        `;

        // === QUALIT√â DU CODE ===
        const statementsScore = audit.coverage?.statements || 0;
        const functionsScore = audit.coverage?.functions || 0;
        const branchesScore = audit.coverage?.branches || 0;
        const linesScore = audit.coverage?.lines || 0;

        // Utiliser le meilleur score disponible pour le r√©sum√©
        const mainCoverageScore = statementsScore > 0 ? statementsScore : linesScore;
        const mainCoverageLabel = statementsScore > 0 ? 'statements' : 'lignes';
        const hasCoverageData = mainCoverageScore > 0 || functionsScore > 0 || branchesScore > 0;

        document.getElementById('rncp-quality').innerHTML = `
            <!-- Explication Qualit√© -->
            <div class="p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg mb-6">
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üí°</div>
                    <div>
                        <div class="text-sm font-semibold text-purple-300 mb-2">Pourquoi mesurer la qualit√© du code ?</div>
                        <div class="text-xs text-gray-300 space-y-1">
                            <p>La <strong>qualit√© du code</strong> se mesure par la <strong>couverture de tests</strong> : pourcentage de code test√© automatiquement.</p>
                            <p class="pt-2">Objectif : <strong>‚â• 80%</strong> pour garantir la fiabilit√© et faciliter la maintenance. Les m√©triques incluent : <strong>statements</strong>, <strong>fonctions</strong>, <strong>branches</strong>, et <strong>lignes</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>

            ${hasCoverageData ? `
                <div class="space-y-4">
                    ${linesScore > 0 ? createCoverageBar('Lignes', linesScore) : ''}
                    ${functionsScore > 0 ? createCoverageBar('Fonctions', functionsScore) : ''}
                    ${branchesScore > 0 ? createCoverageBar('Branches', branchesScore) : ''}
                    ${statementsScore > 0 ? createCoverageBar('Statements', statementsScore) : ''}
                </div>

                <!-- R√©sum√© -->
                <div class="mt-6 p-4 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-lg border border-purple-500/30 text-center">
                    <div class="text-3xl font-bold ${mainCoverageScore >= 80 ? 'text-green-400' : mainCoverageScore >= 60 ? 'text-yellow-400' : 'text-red-400'}">
                        ${mainCoverageScore.toFixed(1)}%
                    </div>
                    <div class="text-sm text-gray-300 mt-2">Couverture globale (${mainCoverageLabel})</div>
                    <div class="text-xs text-gray-400 mt-1">
                        ${mainCoverageScore >= 80 ? '‚úÖ Excellente couverture' : mainCoverageScore >= 60 ? '‚ö†Ô∏è Couverture acceptable' : '‚ùå Couverture insuffisante'}
                    </div>
                </div>

                <!-- T√©l√©chargement -->
                <div class="mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-medium text-gray-300">üì• T√©l√©charger l'audit Qualit√©</div>
                            <div class="text-xs text-gray-400 mt-1">Fichier JSON avec m√©triques de couverture d√©taill√©es</div>
                        </div>
                        <button onclick="downloadAuditJSON('quality')"
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2">
                            <span>üìÑ</span>
                            <span>T√©l√©charger</span>
                        </button>
                    </div>
                </div>
            ` : `
                <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">‚ö†Ô∏è</div>
                        <div class="text-sm text-yellow-300">
                            Donn√©es de couverture non disponibles. Ex√©cutez <code class="px-2 py-1 bg-gray-800 rounded">npm run test:coverage</code> pour g√©n√©rer ces m√©triques.
                        </div>
                    </div>
                </div>
            `}
        `;

        // Initialiser les onglets RNCP
        initRncpTabs();
    }

    // Variable globale pour stocker l'audit actuel
    let currentAudit = null;

    // Fonction pour t√©l√©charger l'audit en JSON
    function downloadAuditJSON(section = 'complet') {
        if (!currentAudit) {
            alert('Aucun audit disponible pour le t√©l√©chargement.');
            return;
        }

        const timestamp = new Date(currentAudit.timestamp).toISOString().split('T')[0];
        let filename, data;

        if (section === 'complet') {
            filename = `audit-rncp-complet-${timestamp}.json`;
            data = currentAudit;
        } else if (section === 'performance') {
            filename = `audit-performance-${timestamp}.json`;
            data = {
                timestamp: currentAudit.timestamp,
                lighthouse: currentAudit.lighthouse,
                fps: currentAudit.fps,
                datasets: currentAudit.datasets
            };
        } else if (section === 'accessibility') {
            filename = `audit-accessibilite-${timestamp}.json`;
            data = {
                timestamp: currentAudit.timestamp,
                lighthouse: { scores: { accessibility: currentAudit.lighthouse?.scores?.accessibility } },
                a11y: currentAudit.a11y,
                daltonisme: currentAudit.daltonisme,
                riskLevels: currentAudit.riskLevels
            };
        } else if (section === 'eco') {
            filename = `audit-eco-conception-${timestamp}.json`;
            data = {
                timestamp: currentAudit.timestamp,
                eco: currentAudit.eco
            };
        } else if (section === 'quality') {
            filename = `audit-qualite-${timestamp}.json`;
            data = {
                timestamp: currentAudit.timestamp,
                coverage: currentAudit.coverage
            };
        }

        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });

        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    // Fonction utilitaire pour cr√©er une jauge de score
    function createScoreGauge(label, score, icon) {
        const color = score >= 90 ? '#10b981' : score >= 50 ? '#f59e0b' : '#ef4444';
        const strokeDasharray = `${(score / 100) * 251} 251`;

        return `
            <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                <div class="relative mx-auto" style="width: 80px; height: 80px;">
                    <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 84 84">
                        <circle cx="42" cy="42" r="40" stroke="rgba(255,255,255,0.1)" stroke-width="4" fill="none"/>
                        <circle cx="42" cy="42" r="40" stroke="${color}" stroke-width="4" fill="none"
                                stroke-linecap="round" stroke-dasharray="${strokeDasharray}"
                                class="transition-all duration-1000 ease-out"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-xl font-bold" style="color: ${color}">${score.toFixed(0)}</div>
                        </div>
                    </div>
                </div>
                <div class="text-sm mt-2">${icon} ${label}</div>
            </div>
        `;
    }

    // Fonction utilitaire pour cr√©er une barre de couverture
    function createCoverageBar(label, percentage) {
        const color = percentage >= 80 ? '#10b981' : percentage >= 60 ? '#f59e0b' : '#ef4444';

        return `
            <div class="p-3 bg-gray-800/50 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm font-medium">${label}</div>
                    <div class="text-lg font-bold" style="color: ${color}">${percentage.toFixed(1)}%</div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="h-2 rounded-full transition-all duration-1000"
                         style="width: ${percentage}%; background: ${color}"></div>
                </div>
            </div>
        `;
    }

    // Fonction pour remplir les d√©tails Lighthouse par onglet
    function renderLighthouseDetails(lighthouse, scores, failedAudits) {
        const getScoreColor = (score) => {
            if (score >= 90) return '#10b981';
            if (score >= 70) return '#f59e0b';
            return '#ef4444';
        };

        const getScoreClass = (score) => {
            if (score >= 90) return 'text-green-400';
            if (score >= 70) return 'text-yellow-400';
            return 'text-red-400';
        };

        // Onglet Performance - Utiliser les audits r√©els √©chou√©s
        const perfRecommendations = [];

        if (failedAudits?.performance && failedAudits.performance.length > 0) {
            // Utiliser les vrais audits √©chou√©s
            failedAudits.performance.forEach(audit => {
                let icon = '‚ö°';
                if (audit.id.includes('paint')) icon = 'üé®';
                else if (audit.id.includes('blocking')) icon = 'üö´';
                else if (audit.id.includes('image')) icon = 'üñºÔ∏è';

                perfRecommendations.push({
                    icon: icon,
                    title: audit.title,
                    desc: audit.description.replace(/\[.*?\]\(.*?\)/g, '').substring(0, 150) + (audit.description.length > 150 ? '...' : ''),
                    displayValue: audit.displayValue || ''
                });
            });
        } else {
            // Fallback sur les recommandations g√©n√©riques si pas de donn√©es
            if (scores.performance < 90) {
                perfRecommendations.push({
                    icon: 'üì¶',
                    title: 'Optimiser les ressources (images, JS, CSS)',
                    desc: 'Compresser les images (WebP), minifier JS/CSS, utiliser code splitting',
                    displayValue: ''
                });
            }
        }

        document.getElementById('lighthouse-performance-content').innerHTML = `
            <div class="space-y-4">
                <div class="p-4 bg-orange-500/10 border border-orange-500/30 rounded-lg">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">üí°</div>
                        <div>
                            <div class="text-sm font-semibold text-orange-300 mb-2">Pourquoi la Performance est cruciale ?</div>
                            <div class="text-xs text-gray-300 space-y-1">
                                <p>Une application <strong>rapide</strong> am√©liore l'exp√©rience utilisateur, r√©duit le taux de rebond, et favorise le r√©f√©rencement.</p>
                                <p class="pt-2"><strong>Core Web Vitals</strong> (Google) : m√©triques essentielles pour l'UX.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-6 bg-gray-800/50 rounded-lg">
                    <div class="text-4xl font-bold ${getScoreClass(scores.performance)} mb-2">${scores.performance}</div>
                    <div class="text-sm text-gray-400">Score Performance</div>
                    ${scores.performance >= 90 ?
                        '<div class="mt-2 text-xs text-green-400">‚úÖ Performance excellente !</div>' :
                        scores.performance >= 70 ?
                        '<div class="mt-2 text-xs text-yellow-400">‚ö†Ô∏è Performance correcte, optimisations possibles.</div>' :
                        '<div class="mt-2 text-xs text-red-400">‚ùå Performance √† am√©liorer d\'urgence.</div>'
                    }
                </div>

                ${perfRecommendations.length > 0 ? `
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-semibold text-yellow-300 mb-3">‚ö†Ô∏è Points √† am√©liorer (depuis rapport Lighthouse)</div>
                        <div class="space-y-3">
                            ${perfRecommendations.map(rec => `
                                <div class="flex items-start gap-3">
                                    <div class="text-xl">${rec.icon}</div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between gap-2">
                                            <div class="text-sm font-medium text-yellow-200">${rec.title}</div>
                                            ${rec.displayValue ? `<div class="text-xs text-yellow-400 font-mono">${rec.displayValue}</div>` : ''}
                                        </div>
                                        <div class="text-xs text-gray-300 mt-1">${rec.desc}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${lighthouse.metrics ? `
                    <div class="space-y-2">
                        <div class="text-sm font-medium text-gray-300 mb-3">‚ö° Core Web Vitals</div>

                        <div class="p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-sm font-medium">First Contentful Paint (FCP)</div>
                                <div class="text-sm font-mono ${getScoreClass(100)}">${lighthouse.metrics.fcp || lighthouse.metrics.firstContentfulPaint || 'N/A'}s</div>
                            </div>
                            <div class="text-xs text-gray-400">Temps avant affichage du premier contenu</div>
                        </div>

                        <div class="p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-sm font-medium">Largest Contentful Paint (LCP)</div>
                                <div class="text-sm font-mono ${getScoreClass(100)}">${lighthouse.metrics.lcp || lighthouse.metrics.largestContentfulPaint || 'N/A'}s</div>
                            </div>
                            <div class="text-xs text-gray-400">Temps de chargement du plus grand √©l√©ment visible</div>
                        </div>

                        <div class="p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-sm font-medium">Total Blocking Time (TBT)</div>
                                <div class="text-sm font-mono ${getScoreClass(100)}">${lighthouse.metrics.tbt || lighthouse.metrics.totalBlockingTime || 'N/A'}ms</div>
                            </div>
                            <div class="text-xs text-gray-400">Temps o√π la page est bloqu√©e (non interactive)</div>
                        </div>

                        <div class="p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-sm font-medium">Cumulative Layout Shift (CLS)</div>
                                <div class="text-sm font-mono ${getScoreClass(100)}">${lighthouse.metrics.cls || lighthouse.metrics.cumulativeLayoutShift || 'N/A'}</div>
                            </div>
                            <div class="text-xs text-gray-400">Stabilit√© visuelle (d√©placements inattendus)</div>
                        </div>

                        <div class="p-3 bg-gray-800/50 rounded-lg">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-sm font-medium">Speed Index</div>
                                <div class="text-sm font-mono ${getScoreClass(100)}">${lighthouse.metrics.speedIndex || 'N/A'}s</div>
                            </div>
                            <div class="text-xs text-gray-400">Vitesse d'affichage du contenu visible</div>
                        </div>
                    </div>
                ` : '<p class="text-xs text-gray-400">M√©triques Web Vitals non disponibles</p>'}
            </div>
        `;

        // Onglet Accessibilit√© - Utiliser les audits r√©els √©chou√©s
        const a11yRecommendations = [];

        if (failedAudits?.accessibility && failedAudits.accessibility.length > 0) {
            // Utiliser les vrais audits √©chou√©s
            failedAudits.accessibility.forEach(audit => {
                let icon = '‚ôø';
                if (audit.id.includes('aria')) icon = 'üè∑Ô∏è';
                else if (audit.id.includes('button') || audit.id.includes('link')) icon = 'üîò';
                else if (audit.id.includes('contrast')) icon = 'üé®';
                else if (audit.id.includes('label') || audit.id.includes('name')) icon = 'üìù';

                a11yRecommendations.push({
                    icon: icon,
                    title: audit.title,
                    desc: audit.description.replace(/\[.*?\]\(.*?\)/g, '').substring(0, 150) + (audit.description.length > 150 ? '...' : ''),
                    displayValue: audit.displayValue || ''
                });
            });
        } else {
            // Fallback sur les recommandations g√©n√©riques si pas de donn√©es
            if (scores.accessibility < 90) {
                a11yRecommendations.push({
                    icon: 'üè∑Ô∏è',
                    title: 'Ajouter des labels ARIA manquants',
                    desc: 'V√©rifier que tous les √©l√©ments interactifs ont des aria-label ou aria-labelledby',
                    displayValue: ''
                });
            }
        }

        document.getElementById('lighthouse-accessibility-content').innerHTML = `
            <div class="space-y-4">
                <div class="p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">üí°</div>
                        <div>
                            <div class="text-sm font-semibold text-purple-300 mb-2">Pourquoi l'Accessibilit√© ?</div>
                            <div class="text-xs text-gray-300 space-y-1">
                                <p>L'<strong>accessibilit√©</strong> garantit que votre application est utilisable par <strong>tous</strong>, y compris les personnes en situation de handicap.</p>
                                <p class="pt-2">Lighthouse v√©rifie : <strong>ARIA</strong>, <strong>navigation clavier</strong>, <strong>contrastes</strong>, <strong>labels</strong>.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-6 bg-gray-800/50 rounded-lg">
                    <div class="text-4xl font-bold ${getScoreClass(scores.accessibility)} mb-2">${scores.accessibility}</div>
                    <div class="text-sm text-gray-400">Score Accessibilit√©</div>
                    ${scores.accessibility >= 90 ?
                        '<div class="mt-2 text-xs text-green-400">‚úÖ Score excellent ! Continuez ainsi.</div>' :
                        scores.accessibility >= 70 ?
                        '<div class="mt-2 text-xs text-yellow-400">‚ö†Ô∏è Bon score, mais am√©liorations possibles ci-dessous.</div>' :
                        '<div class="mt-2 text-xs text-red-400">‚ùå Score √† am√©liorer - voir recommandations ci-dessous.</div>'
                    }
                </div>

                ${a11yRecommendations.length > 0 ? `
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-semibold text-yellow-300 mb-3">‚ö†Ô∏è Points √† am√©liorer (depuis rapport Lighthouse)</div>
                        <div class="space-y-3">
                            ${a11yRecommendations.map(rec => `
                                <div class="flex items-start gap-3">
                                    <div class="text-xl">${rec.icon}</div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between gap-2">
                                            <div class="text-sm font-medium text-yellow-200">${rec.title}</div>
                                            ${rec.displayValue ? `<div class="text-xs text-yellow-400 font-mono">${rec.displayValue}</div>` : ''}
                                        </div>
                                        <div class="text-xs text-gray-300 mt-1">${rec.desc}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm font-medium text-gray-300 mb-3">‚ôø Points v√©rifi√©s</div>
                    <div class="space-y-2 text-xs">
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Attributs ARIA appropri√©s</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Navigation clavier fonctionnelle</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Labels accessibles sur les formulaires</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Contrastes de couleurs suffisants</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Structure HTML s√©mantique</span>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Onglet SEO
        const seoRecommendations = [];
        if (scores.seo < 95) {
            seoRecommendations.push({
                icon: 'üìù',
                title: 'Am√©liorer les meta descriptions',
                desc: 'Ajouter des meta descriptions uniques et descriptives (150-160 caract√®res) sur chaque page'
            });
        }
        if (scores.seo < 90) {
            seoRecommendations.push({
                icon: 'üîó',
                title: 'V√©rifier les liens internes',
                desc: 'S\'assurer que tous les liens internes sont fonctionnels et utilisent des ancres descriptives'
            });
        }
        if (scores.seo < 85) {
            seoRecommendations.push({
                icon: 'üó∫Ô∏è',
                title: 'Cr√©er/mettre √† jour le sitemap.xml',
                desc: 'G√©n√©rer un sitemap.xml √† jour et le soumettre √† Google Search Console'
            });
        }
        if (scores.seo < 80) {
            seoRecommendations.push({
                icon: 'üì±',
                title: 'Optimiser pour mobile',
                desc: 'V√©rifier que le design est responsive et que le viewport est correctement configur√©'
            });
        }

        document.getElementById('lighthouse-seo-content').innerHTML = `
            <div class="space-y-4">
                <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">üí°</div>
                        <div>
                            <div class="text-sm font-semibold text-green-300 mb-2">Pourquoi le SEO ?</div>
                            <div class="text-xs text-gray-300 space-y-1">
                                <p>Le <strong>SEO</strong> (Search Engine Optimization) am√©liore la visibilit√© de votre application dans les <strong>moteurs de recherche</strong>.</p>
                                <p class="pt-2">Lighthouse v√©rifie : <strong>meta tags</strong>, <strong>robots.txt</strong>, <strong>sitemap</strong>, <strong>structure des liens</strong>.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-6 bg-gray-800/50 rounded-lg">
                    <div class="text-4xl font-bold ${getScoreClass(scores.seo)} mb-2">${scores.seo}</div>
                    <div class="text-sm text-gray-400">Score SEO</div>
                    ${scores.seo >= 90 ?
                        '<div class="mt-2 text-xs text-green-400">‚úÖ SEO optimal !</div>' :
                        scores.seo >= 70 ?
                        '<div class="mt-2 text-xs text-yellow-400">‚ö†Ô∏è SEO correct, am√©liorations possibles.</div>' :
                        '<div class="mt-2 text-xs text-red-400">‚ùå SEO √† am√©liorer pour meilleur r√©f√©rencement.</div>'
                    }
                </div>

                ${seoRecommendations.length > 0 ? `
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-semibold text-yellow-300 mb-3">‚ö†Ô∏è Am√©liorations SEO recommand√©es</div>
                        <div class="space-y-3">
                            ${seoRecommendations.map(rec => `
                                <div class="flex items-start gap-3">
                                    <div class="text-xl">${rec.icon}</div>
                                    <div>
                                        <div class="text-sm font-medium text-yellow-200">${rec.title}</div>
                                        <div class="text-xs text-gray-300 mt-1">${rec.desc}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm font-medium text-gray-300 mb-3">üîç Points v√©rifi√©s</div>
                    <div class="space-y-2 text-xs">
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Meta description pr√©sente</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Titre de page unique et descriptif</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">robots.txt valide</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Sitemap.xml disponible</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Liens internes fonctionnels</span>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Onglet Best Practices
        const bestPracticesRecommendations = [];
        if (scores.bestPractices < 100) {
            bestPracticesRecommendations.push({
                icon: 'üîí',
                title: 'V√©rifier HTTPS sur toutes les ressources',
                desc: 'S\'assurer que toutes les ressources (images, scripts, styles) sont charg√©es en HTTPS'
            });
        }
        if (scores.bestPractices < 95) {
            bestPracticesRecommendations.push({
                icon: 'üêõ',
                title: 'Corriger les erreurs console',
                desc: 'Ouvrir DevTools > Console et corriger toutes les erreurs JavaScript affich√©es'
            });
        }
        if (scores.bestPractices < 90) {
            bestPracticesRecommendations.push({
                icon: 'üì¶',
                title: 'Mettre √† jour les d√©pendances vuln√©rables',
                desc: 'Ex√©cuter npm audit fix pour corriger les vuln√©rabilit√©s de s√©curit√© connues'
            });
        }
        if (scores.bestPractices < 85) {
            bestPracticesRecommendations.push({
                icon: 'üñºÔ∏è',
                title: 'Sp√©cifier les dimensions des images',
                desc: 'Ajouter width et height sur les balises <img> pour √©viter les Layout Shifts'
            });
        }

        document.getElementById('lighthouse-best-practices-content').innerHTML = `
            <div class="space-y-4">
                <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">üí°</div>
                        <div>
                            <div class="text-sm font-semibold text-blue-300 mb-2">Pourquoi les Best Practices ?</div>
                            <div class="text-xs text-gray-300 space-y-1">
                                <p>Les <strong>bonnes pratiques</strong> assurent la <strong>s√©curit√©</strong>, la <strong>fiabilit√©</strong> et la <strong>maintenabilit√©</strong> de votre application.</p>
                                <p class="pt-2">Lighthouse v√©rifie : <strong>HTTPS</strong>, <strong>console errors</strong>, <strong>images optimis√©es</strong>, <strong>d√©pendances √† jour</strong>.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-6 bg-gray-800/50 rounded-lg">
                    <div class="text-4xl font-bold ${getScoreClass(scores.bestPractices)} mb-2">${scores.bestPractices}</div>
                    <div class="text-sm text-gray-400">Score Best Practices</div>
                    ${scores.bestPractices >= 95 ?
                        '<div class="mt-2 text-xs text-green-400">‚úÖ Bonnes pratiques respect√©es !</div>' :
                        scores.bestPractices >= 80 ?
                        '<div class="mt-2 text-xs text-yellow-400">‚ö†Ô∏è Quelques ajustements recommand√©s.</div>' :
                        '<div class="mt-2 text-xs text-red-400">‚ùå Bonnes pratiques √† am√©liorer.</div>'
                    }
                </div>

                ${bestPracticesRecommendations.length > 0 ? `
                    <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <div class="text-sm font-semibold text-yellow-300 mb-3">‚ö†Ô∏è Actions recommand√©es</div>
                        <div class="space-y-3">
                            ${bestPracticesRecommendations.map(rec => `
                                <div class="flex items-start gap-3">
                                    <div class="text-xl">${rec.icon}</div>
                                    <div>
                                        <div class="text-sm font-medium text-yellow-200">${rec.title}</div>
                                        <div class="text-xs text-gray-300 mt-1">${rec.desc}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="text-sm font-medium text-gray-300 mb-3">‚úÖ Points v√©rifi√©s</div>
                    <div class="space-y-2 text-xs">
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">HTTPS activ√© (connexion s√©curis√©e)</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Aucune erreur console JavaScript</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Images avec dimensions correctes</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Biblioth√®ques sans vuln√©rabilit√©s connues</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span class="text-gray-300">Doctype HTML5 d√©clar√©</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // Fonction pour g√©rer la navigation des onglets Lighthouse
    function initLighthouseTabs() {
        const tabs = document.querySelectorAll('.lighthouse-tab');
        const panels = document.querySelectorAll('.lighthouse-panel');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;

                // D√©sactiver tous les onglets
                tabs.forEach(t => {
                    t.classList.remove('active', 'bg-purple-500', 'text-white');
                    t.classList.add('text-gray-400');
                });

                // D√©sactiver tous les panneaux
                panels.forEach(p => p.classList.remove('active'));

                // Activer l'onglet et panneau cliqu√©s
                tab.classList.add('active', 'bg-purple-500', 'text-white');
                tab.classList.remove('text-gray-400');

                const targetPanel = document.querySelector(`.lighthouse-panel[data-panel="${targetTab}"]`);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });
    }

    // Fonction pour g√©rer les onglets Coverage
    function initCoverageTabs() {
        const tabs = document.querySelectorAll('.coverage-tab');
        const contents = document.querySelectorAll('.coverage-tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetIndex = tab.dataset.coverageIndex;

                // D√©sactiver tous les onglets et contenus
                tabs.forEach(t => {
                    t.classList.remove('active', 'bg-purple-500', 'text-white');
                    t.classList.add('text-gray-400');
                });
                contents.forEach(c => c.classList.remove('active'));

                // Activer l'onglet et le contenu s√©lectionn√©s
                tab.classList.add('active', 'bg-purple-500', 'text-white');
                tab.classList.remove('text-gray-400');
                const content = document.querySelector(`[data-coverage-content="${targetIndex}"]`);
                if (content) content.classList.add('active');
            });
        });
    }

    // Fonction pour g√©rer les onglets RNCP
    function initRncpTabs() {
        const tabs = document.querySelectorAll('.rncp-tab');
        const panels = document.querySelectorAll('.rncp-panel');
        const rncpContent = document.getElementById('rncp-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;

                // D√©sactiver tous les onglets
                tabs.forEach(t => {
                    t.classList.remove('active', 'bg-purple-500', 'text-white');
                    t.classList.add('text-gray-400');
                });

                // D√©sactiver tous les panneaux
                panels.forEach(p => {
                    p.classList.remove('active');
                });

                // Activer l'onglet cliqu√©
                tab.classList.add('active', 'bg-purple-500', 'text-white');
                tab.classList.remove('text-gray-400');

                // Activer le panneau correspondant
                const targetPanel = rncpContent.querySelector(`[data-panel="${targetTab}"]`);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });
    }

    async function loadCoverage() {
        // Chargement et traitement des donn√©es de couverture - CORRIG√â pour utiliser le bon chemin
        const candidates = [
            './coverage/coverage-final.json', // Local - dossier metrics
            '../../../coverage/coverage-final.json', // Racine du projet depuis metrics
            '../../coverage/coverage-final.json', // Alternative
            'https://sandrinecipolla.github.io/stockHub_V2_front/coverage/coverage-final.json' // GitHub Pages (si publi√©)
        ];
        let data = null;
        let usedUrl = null;

        for (const url of candidates) {
            try {
                console.log(`Tentative de chargement: ${url}`);
                const r = await fetch(url);
                if (r.ok) {
                    data = await r.json();
                    usedUrl = url;
                    console.log(`Coverage charg√©e depuis: ${url}`);
                    break;
                } else {
                    console.log(`√âchec ${url}: ${r.status}`);
                }
            } catch (e) {
                console.log(`Erreur ${url}:`, e.message);
            }
        }

        const container = document.getElementById('coverage-content');
        if (!data) {
            container.innerHTML = `
                <p class="text-red-400">‚ùå Impossible de charger coverage-final.json</p>
                <p class="text-xs opacity-60 mt-2">Tentatives effectu√©es :</p>
                <ul class="text-xs opacity-60 mt-1">
                    ${candidates.map(url => `<li>‚Ä¢ ${url}</li>`).join('')}
                </ul>
                <p class="text-xs opacity-60 mt-2">Assurez-vous que les tests de couverture ont √©t√© ex√©cut√©s avec <code>npm run test:coverage</code></p>
            `;
            return;
        }

        const GROUP_RULES = [
            { id:'dashboard', label:'Dashboard', help:'Vue principale et widgets du tableau de bord', match:f=> /pages[\\\/]Dashboard|Dashboard/i.test(f) },
            { id:'analytics', label:'Analytics', help:'Pages et logique analytique', match:f=> /pages[\\\/]Analytics|analytics/i.test(f) },
            { id:'components', label:'Components UI', help:'Composants r√©utilisables (src/components)', match:f=> /components[\\\/]/.test(f) },
            { id:'hooks', label:'Hooks', help:'Hooks personnalis√©s (src/hooks)', match:f=> /hooks[\\\/]/.test(f) },
            { id:'utils', label:'Utils', help:'Fonctions utilitaires diverses', match:f=> /utils[\\\/]/.test(f) },
            { id:'contexts', label:'Contexts', help:'Gestion des contextes React (src/contexts)', match:f=> /contexts[\\\/]/.test(f) },
            { id:'data', label:'Data Layer', help:'Acc√®s et mod√®les de donn√©es (src/data)', match:f=> /data[\\\/]/.test(f) }
        ];

        let totalStatements=0, coveredStatements=0;
        const fileCoverages=[];
        for (const [fileName, fileObj] of Object.entries(data)) {
            if (!fileObj || !fileObj.s) continue;
            const sVals = Object.values(fileObj.s);
            const fileStatements = sVals.length;
            const fileCoveredStatements = sVals.filter(v=>v>0).length;
            totalStatements += fileStatements;
            coveredStatements += fileCoveredStatements;
            if (fileStatements>0) {
                fileCoverages.push({ raw:fileName, file: fileName.replace(/^.*src[\\\/]/,''), statements:fileStatements, covered:fileCoveredStatements });
            }
        }
        const pct=(c,t)=> t===0?0:(c/t*100);

        const groupMap = GROUP_RULES.map(g=>({ id:g.id, label:g.label, help:g.help, statements:0, covered:0 }));
        for (const fc of fileCoverages) {
            const match = GROUP_RULES.find(gr=> gr.match(fc.raw));
            if (match) {
                const target = groupMap.find(g=>g.id===match.id);
                target.statements += fc.statements;
                target.covered += fc.covered;
            }
        }
        const effectiveGroups = groupMap.filter(g=> g.statements>0).map(g=> ({...g, pct: pct(g.covered,g.statements)}));
        const sortedGroups = [...effectiveGroups].sort((a,b)=> a.pct - b.pct);
        const bestGroups = [...effectiveGroups].sort((a,b)=> b.pct - a.pct).slice(0,3);

        const withPctFiles = fileCoverages.map(f=> ({...f, pct: pct(f.covered,f.statements)}));
        const worst = withPctFiles.filter(f=> f.statements>=5).sort((a,b)=> a.pct - b.pct).slice(0,5);
        const best = withPctFiles.filter(f=> f.statements>=5).sort((a,b)=> b.pct - a.pct).slice(0,5);

        const colorFor = p => p>=85? 'text-green-400' : p>=70? 'text-yellow-400' : 'text-red-400';
        const bar = p => `<div class='h-2 w-full bg-white/10 rounded'><div class='h-2 rounded bg-[var(--sh-purple-500)]' style='width:${p.toFixed(1)}%'></div></div>`;
        const listBlock = (title, arr) => arr.length ? `<div class='mt-8'><h3 class='font-semibold mb-2 text-sm'>${title}</h3><ul class='space-y-1 text-xs'>${arr.map(f=> `<li class='flex justify-between'><span class='truncate max-w-[65%]' title='${f.file}'>${f.file}</span><span class='${colorFor(f.pct)}'>${f.pct.toFixed(1)}%</span></li>`).join('')}</ul></div>` : '';

        const groupBlock = effectiveGroups.length ? `
          <div class='mt-8'>
            <h3 class='font-semibold mb-2 text-sm'>Couverture par domaine fonctionnel</h3>
            <div class='space-y-3'>
              ${sortedGroups.map(g=>`
                <div>
                  <div class='flex justify-between mb-0.5'>
                    <span class='tooltip-wrapper' tabindex='0'>${g.label} <span class='tooltip-box'>${g.help}</span></span>
                    <span class='${colorFor(g.pct)} text-xs'>${g.pct.toFixed(1)}%</span>
                  </div>
                  ${bar(g.pct)}
                </div>
              `).join('')}
            </div>
            <div class='mt-4 text-xs opacity-60'>Top domaines bien couverts : ${bestGroups.map(g=> g.label + ' (' + g.pct.toFixed(0)+'%)').join(', ')}</div>
          </div>`
          : '<div class="mt-8 text-xs opacity-60">Aucun regroupement fonctionnel d√©tect√© (v√©rifiez vos dossiers).</div>';

        // === Ajout r√®gles fonctionnalit√©s utilisateur ===
        const FEATURE_RULES = [
          { id:'crud', label:'Gestion Stocks (CRUD)', help:'Cr√©ation, mise √† jour, filtrage des stocks (useStocks, Dashboard, config)', match:f=> /(hooks[\\\/]useStocks|pages[\\\/]Dashboard|stockConfig|stockData)/i.test(f) },
          { id:'prediction', label:'Pr√©dictions IA', help:'Simulation & composant pr√©diction (mlSimulation, StockPrediction, aiPredictions)', match:f=> /(utils[\\\/]mlSimulation|components[\\\/]ai[\\\/]StockPrediction|utils[\\\/]aiPredictions)/i.test(f) },
          { id:'alerts', label:'Alertes & Statuts', help:'Badges statut, calcul niveaux de risque, config', match:f=> /(StatusBadge|statusBadge|stockConfig|risk-levels|determineRiskLevel)/i.test(f) },
          { id:'preferences', label:'Pr√©f√©rences & Th√®me', help:'Gestion th√®me & pr√©f√©rences utilisateur', match:f=> /(contexts[\\\/]theme)/i.test(f) },
          { id:'dataLayer', label:'Couche Donn√©es', help:'Structures & acc√®s (src/data)', match:f=> /src[\\\/]data[\\\/]/i.test(f) },
          { id:'support', label:'Support g√©n√©rique', help:'Hooks/Utils techniques hors CRUD sp√©cifique', match:f=> /(src[\\\/]utils|src[\\\/]hooks)/i.test(f) }
        ];
        function aggregateByRules(rules, files) {
          const groups = rules.map(r=> ({ ...r, statements:0, covered:0, files:[] }));
          for (const fc of files) {
            const rule = rules.find(r=> r.match(fc.raw));
            if (rule) {
              const g = groups.find(gr=> gr.id===rule.id);
              g.statements += fc.statements;
              g.covered += fc.covered;
              g.files.push(fc);
            }
          }
          return groups.filter(g=> g.statements>0).map(g=> ({ ...g, pct: pct(g.covered,g.statements) }));
        }
        const featureGroups = aggregateByRules(FEATURE_RULES, fileCoverages);
        const sortedFeatureGroups = [...featureGroups].sort((a,b)=> a.pct - b.pct);
        const topFeatureGroups = [...featureGroups].sort((a,b)=> b.pct - a.pct).slice(0,3);
        const featureBlock = featureGroups.length ? `
          <div class='mt-10'>
            <h3 class='font-semibold mb-2 text-sm'>Couverture par fonctionnalit√© (vue utilisateur)</h3>
            <div class='space-y-3'>
              ${sortedFeatureGroups.map(g=> {
                const examples = g.files.sort((a,b)=> b.statements - a.statements).slice(0,2).map(f=> f.file).join(', ');
                return `<div>
                  <div class='flex justify-between mb-0.5'>
                    <span class='tooltip-wrapper' tabindex='0'>${g.label} <span class='tooltip-box'>${g.help}${examples?`<br/><em>Exemples: ${examples}</em>`:''}</span></span>
                    <span class='${colorFor(g.pct)} text-xs'>${g.pct.toFixed(1)}%</span>
                  </div>
                  ${bar(g.pct)}
                </div>`;
              }).join('')}
            </div>
            <div class='mt-4 text-xs opacity-60'>Fonctionnalit√©s mieux couvertes : ${topFeatureGroups.map(g=> g.label + ' (' + g.pct.toFixed(0)+'%)').join(', ')}</div>
          </div>` : `<div class='mt-10 text-xs opacity-60'>Pas de regroupement fonctionnel d√©tect√© (r√®gles non satisfaites).</div>`;

        const globalPct = pct(coveredStatements,totalStatements);
        const progressPercent = Math.min(100, globalPct);
        const strokeDasharray = `${progressPercent * 2.51} 251`;

        container.innerHTML = `
          <div class='space-y-4'>
            <!-- Explication Coverage -->
            <div class='p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg'>
              <div class='flex items-start gap-3'>
                <div class='text-2xl'>üí°</div>
                <div>
                  <div class='text-sm font-semibold text-blue-300 mb-2'>C'est quoi la "Coverage" ?</div>
                  <div class='text-xs text-gray-300 space-y-1'>
                    <p>La <strong>couverture de code</strong> mesure le <strong>pourcentage de code test√©</strong> par les tests unitaires.</p>
                    <p class='pt-2'><strong class='text-blue-400'>‚â• 85%</strong> = Bonne couverture, code bien test√©. <strong class='text-yellow-400'>70-84%</strong> = Couverture moyenne. <strong class='text-red-400'>< 70%</strong> = Faible, risque de bugs non d√©tect√©s.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- R√©sum√© avec gauge -->
            <div class='flex items-center justify-between'>
              <div class='relative'>
                <svg class='w-16 h-16 transform -rotate-90' viewBox='0 0 84 84'>
                  <circle cx='42' cy='42' r='40' stroke='rgba(255,255,255,0.1)' stroke-width='4' fill='none'/>
                  <circle cx='42' cy='42' r='40' stroke='${globalPct >= 85 ? '#10b981' : globalPct >= 70 ? '#f59e0b' : '#ef4444'}'
                          stroke-width='4' fill='none' stroke-linecap='round'
                          stroke-dasharray='${strokeDasharray}' class='transition-all duration-1000 ease-out'/>
                </svg>
                <div class='absolute inset-0 flex items-center justify-center'>
                  <div class='text-center'>
                    <div class='text-lg font-bold ${colorFor(globalPct)}'>${globalPct.toFixed(0)}%</div>
                    <div class='text-xs text-gray-400'>Code</div>
                  </div>
                </div>
              </div>
              <div class='flex-1 ml-4 space-y-2'>
                <div class='flex items-center justify-between'>
                  <span class='text-sm font-medium'>Couverture globale</span>
                  <span class='text-2xl'>${globalPct >= 85 ? '‚úÖ' : globalPct >= 70 ? '‚ö†Ô∏è' : '‚ùå'}</span>
                </div>
                <div class='text-xs text-gray-300'>${totalStatements} instructions test√©es</div>
                <div class='text-xs ${colorFor(globalPct)}'>
                  ${coveredStatements} / ${totalStatements} instructions couvertes
                </div>
              </div>
            </div>

            <!-- Bar√®me -->
            <div class='grid grid-cols-3 gap-2 text-center text-xs'>
              <div class='p-2 bg-gray-800 rounded'>
                <div class='text-green-400 font-semibold'>‚â• 85%</div>
                <div class='text-gray-400'>Excellent</div>
              </div>
              <div class='p-2 bg-gray-800 rounded'>
                <div class='text-yellow-400 font-semibold'>70-84%</div>
                <div class='text-gray-400'>Moyen</div>
              </div>
              <div class='p-2 bg-gray-800 rounded'>
                <div class='text-red-400 font-semibold'>< 70%</div>
                <div class='text-gray-400'>Faible</div>
              </div>
            </div>

            <!-- Navigation onglets Coverage -->
            <div class='mb-4'>
              <div class='text-sm font-medium text-gray-200 mb-2'>üìä Analyse d√©taill√©e</div>
              <div class='flex flex-wrap gap-1 bg-gray-800/50 p-1 rounded-lg' id='coverage-tabs-container'>
                <button class='coverage-tab active bg-purple-500 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors' data-coverage-index='0'>
                  Vue d'ensemble
                </button>
                <button class='coverage-tab text-gray-400 hover:text-white hover:bg-gray-700 px-3 py-1.5 rounded text-xs font-medium transition-colors' data-coverage-index='1'>
                  Par domaine
                </button>
                <button class='coverage-tab text-gray-400 hover:text-white hover:bg-gray-700 px-3 py-1.5 rounded text-xs font-medium transition-colors' data-coverage-index='2'>
                  Par fonctionnalit√©
                </button>
                <button class='coverage-tab text-gray-400 hover:text-white hover:bg-gray-700 px-3 py-1.5 rounded text-xs font-medium transition-colors' data-coverage-index='3'>
                  Fichiers
                </button>
              </div>
            </div>

            <!-- Contenu des onglets Coverage -->
            <div id='coverage-content-tabs'>
              <!-- Onglet 0: Vue d'ensemble -->
              <div class='coverage-tab-content active' data-coverage-content='0'>
                <div class='p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg space-y-3'>
                  <div class='text-sm font-semibold text-gray-200'>üìà R√©sum√© de la couverture</div>
                  <div class='grid grid-cols-2 gap-3 text-center'>
                    <div class='p-3 bg-gray-800/50 rounded'>
                      <div class='text-xs text-gray-400 mb-1'>Instructions totales</div>
                      <div class='text-lg font-bold text-gray-300'>${totalStatements}</div>
                    </div>
                    <div class='p-3 bg-gray-800/50 rounded'>
                      <div class='text-xs text-gray-400 mb-1'>Instructions couvertes</div>
                      <div class='text-lg font-bold ${colorFor(globalPct)}'>${coveredStatements}</div>
                    </div>
                  </div>
                  <div class='flex items-center justify-between text-xs'>
                    <span class='text-gray-400'>Pourcentage de couverture</span>
                    <span class='font-semibold ${colorFor(globalPct)}'>${globalPct.toFixed(1)}%</span>
                  </div>
                  <div class='text-xs text-gray-400'>
                    Source: <code class='text-purple-300'>${usedUrl.split('/').pop()}</code>
                  </div>
                </div>
              </div>

              <!-- Onglet 1: Par domaine -->
              <div class='coverage-tab-content' data-coverage-content='1'>
                ${effectiveGroups.length ? `
                  <div class='p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg space-y-3'>
                    <div class='text-sm font-semibold text-gray-200'>üóÇÔ∏è Couverture par domaine fonctionnel</div>
                    <div class='space-y-3'>
                      ${sortedGroups.map(g=>`
                        <div>
                          <div class='flex justify-between mb-1'>
                            <span class='tooltip-wrapper text-xs' tabindex='0'>${g.label} <span class='tooltip-box'>${g.help}</span></span>
                            <span class='${colorFor(g.pct)} text-xs font-semibold'>${g.pct.toFixed(1)}%</span>
                          </div>
                          ${bar(g.pct)}
                        </div>
                      `).join('')}
                    </div>
                    <div class='mt-3 pt-3 border-t border-gray-700 text-xs text-gray-400'>
                      <strong>Top domaines:</strong> ${bestGroups.map(g=> g.label + ' (' + g.pct.toFixed(0)+'%)').join(', ')}
                    </div>
                  </div>
                ` : `<div class='p-4 bg-gray-800/50 rounded-lg text-xs text-gray-400'>Aucun regroupement fonctionnel d√©tect√©.</div>`}
              </div>

              <!-- Onglet 2: Par fonctionnalit√© -->
              <div class='coverage-tab-content' data-coverage-content='2'>
                ${featureGroups.length ? `
                  <div class='p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg space-y-3'>
                    <div class='text-sm font-semibold text-gray-200'>‚öôÔ∏è Couverture par fonctionnalit√© utilisateur</div>
                    <div class='space-y-3'>
                      ${sortedFeatureGroups.map(g=> {
                        const examples = g.files.sort((a,b)=> b.statements - a.statements).slice(0,2).map(f=> f.file).join(', ');
                        return `<div>
                          <div class='flex justify-between mb-1'>
                            <span class='tooltip-wrapper text-xs' tabindex='0'>${g.label} <span class='tooltip-box'>${g.help}${examples?`<br/><em>Exemples: ${examples}</em>`:''}</span></span>
                            <span class='${colorFor(g.pct)} text-xs font-semibold'>${g.pct.toFixed(1)}%</span>
                          </div>
                          ${bar(g.pct)}
                        </div>`;
                      }).join('')}
                    </div>
                    <div class='mt-3 pt-3 border-t border-gray-700 text-xs text-gray-400'>
                      <strong>Fonctionnalit√©s mieux couvertes:</strong> ${topFeatureGroups.map(g=> g.label + ' (' + g.pct.toFixed(0)+'%)').join(', ')}
                    </div>
                  </div>
                ` : `<div class='p-4 bg-gray-800/50 rounded-lg text-xs text-gray-400'>Pas de regroupement fonctionnel d√©tect√©.</div>`}
              </div>

              <!-- Onglet 3: Fichiers -->
              <div class='coverage-tab-content' data-coverage-content='3'>
                <div class='p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg space-y-4'>
                  ${best.length ? `
                    <div>
                      <div class='text-sm font-semibold text-gray-200 mb-2'>‚úÖ Top qualit√© (meilleurs fichiers)</div>
                      <ul class='space-y-1 text-xs'>
                        ${best.map(f=> `
                          <li class='flex justify-between items-center p-2 bg-gray-800/50 rounded'>
                            <span class='truncate max-w-[70%]' title='${f.file}'>${f.file}</span>
                            <span class='${colorFor(f.pct)} font-semibold'>${f.pct.toFixed(1)}%</span>
                          </li>
                        `).join('')}
                      </ul>
                    </div>
                  ` : ''}
                  ${worst.length ? `
                    <div class='pt-3 ${best.length ? 'border-t border-gray-700' : ''}'>
                      <div class='text-sm font-semibold text-gray-200 mb-2'>‚ö†Ô∏è Priorit√©s d'am√©lioration (faible couverture)</div>
                      <ul class='space-y-1 text-xs'>
                        ${worst.map(f=> `
                          <li class='flex justify-between items-center p-2 bg-gray-800/50 rounded'>
                            <span class='truncate max-w-[70%]' title='${f.file}'>${f.file}</span>
                            <span class='${colorFor(f.pct)} font-semibold'>${f.pct.toFixed(1)}%</span>
                          </li>
                        `).join('')}
                      </ul>
                    </div>
                  ` : ''}
                </div>
              </div>
            </div>

            <!-- Note technique -->
            <div class='p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg'>
              <div class='text-xs text-gray-400'>
                <strong class='text-purple-300'>Note:</strong> Donn√©es extraites de <code>coverage-final.json</code>. Regroupements bas√©s sur l'arborescence des dossiers et des heuristiques fonctionnelles.
              </div>
            </div>
          </div>
        `;

        // Initialiser les onglets Coverage
        setTimeout(() => initCoverageTabs(), 100);

        // Mettre √† jour le badge de statut Coverage
        const coverageStatusBadge = document.getElementById('coverage-status-badge');
        if (coverageStatusBadge) {
            const isGood = globalPct >= 85;
            const isMedium = globalPct >= 70;
            coverageStatusBadge.className = `text-xs px-3 py-1 rounded-full ${
                isGood ? 'bg-green-500/20 text-green-400' :
                isMedium ? 'bg-yellow-500/20 text-yellow-400' :
                'bg-red-500/20 text-red-400'
            }`;
            coverageStatusBadge.textContent = isGood ? `‚úÖ ${globalPct.toFixed(1)}%` : isMedium ? `‚ö†Ô∏è ${globalPct.toFixed(1)}%` : `‚ùå ${globalPct.toFixed(1)}%`;
        }
    }
    // Appels
    loadCoverage();
    loadAllData();
</script>
</body>
</html>
